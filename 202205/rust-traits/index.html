

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" href="/img/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#080000">
  <meta name="author" content="Zelin Wang">
  <meta name="keywords" content="">
  
    <meta name="description" content="本篇文章是对下面文章的阅读笔记，不保证可靠性，希望大家还是以Rust标准库源码&#x2F;英文原文为准 Tour of Rust’s Standard Library Traits 本文亦参考了下面这篇文章，但该文章排版有混乱的地方Tour of Rust’s Standard Library Traits中译 Trait基础1. Self指代实现的类型1234567891011121314151">
<meta property="og:type" content="article">
<meta property="og:title" content="Rust标准库涉及的Trait">
<meta property="og:url" content="https://gwzlchn.github.io/202205/rust-traits/index.html">
<meta property="og:site_name" content="Zelin&#39;s Blog">
<meta property="og:description" content="本篇文章是对下面文章的阅读笔记，不保证可靠性，希望大家还是以Rust标准库源码&#x2F;英文原文为准 Tour of Rust’s Standard Library Traits 本文亦参考了下面这篇文章，但该文章排版有混乱的地方Tour of Rust’s Standard Library Traits中译 Trait基础1. Self指代实现的类型1234567891011121314151">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-05-18T08:39:45.000Z">
<meta property="article:modified_time" content="2022-05-18T09:20:26.305Z">
<meta property="article:author" content="Zelin Wang">
<meta property="article:tag" content="Rust">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>Rust标准库涉及的Trait - Zelin&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"gwzlchn.github.io","root":"/","version":"1.9.0","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"vyfV0Jz8OincT54vffevrlx0-gzGzoHsz","app_key":"abuQhfiaX9zRJg6PYac65qfa","server_url":"https://vyfv0jz8.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 50vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Zelin&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/banner.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Rust标准库涉及的Trait"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-05-18 16:39" pubdate>
          星期三, 五月 18日 2022, 4:39 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          64k 字
        
      </span>
    

    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Rust标准库涉及的Trait</h1>
            
            <div class="markdown-body">
              
              <p>本篇文章是对下面文章的阅读笔记，不保证可靠性，希望大家还是以Rust标准库源码&#x2F;英文原文为准</p>
<p><a target="_blank" rel="noopener" href="https://github.com/pretzelhammer/rust-blog/blob/master/posts/tour-of-rusts-standard-library-traits.md">Tour of Rust’s Standard Library Traits</a></p>
<p>本文亦参考了下面这篇文章，但该文章排版有混乱的地方<br><a target="_blank" rel="noopener" href="https://rustmagazine.github.io/rust_magazine_2021/chapter_7/rusts-standard-library-traits.html">Tour of Rust’s Standard Library Traits中译</a></p>
<h2 id="Trait基础"><a href="#Trait基础" class="headerlink" title="Trait基础"></a>Trait基础</h2><h3 id="1-Self指代实现的类型"><a href="#1-Self指代实现的类型" class="headerlink" title="1. Self指代实现的类型"></a>1. Self指代实现的类型</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Trait</span></span> &#123;<br>    <span class="hljs-comment">// always returns i32</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">returns_num</span></span>() -&gt; <span class="hljs-built_in">i32</span>;<br><br>    <span class="hljs-comment">// returns implementing type</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">returns_self</span></span>() -&gt; <span class="hljs-keyword">Self</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SomeType</span></span>;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">OtherType</span></span>;<br><br><span class="hljs-keyword">impl</span> Trait <span class="hljs-keyword">for</span> SomeType &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">returns_num</span></span>() -&gt; <span class="hljs-built_in">i32</span> &#123;<br>        <span class="hljs-number">5</span><br>    &#125;<br><br>    <span class="hljs-comment">// Self == SomeType</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">returns_self</span></span>() -&gt; <span class="hljs-keyword">Self</span> &#123;<br>        SomeType<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-Function"><a href="#2-Function" class="headerlink" title="2. Function"></a>2. Function</h3><ol>
<li>指代第一个参数不是self的任意函数，类似其他语言的静态函数</li>
<li>只能通过 Typename::func() 方式调用。这里的type实现了trait</li>
</ol>
<h3 id="3-Method"><a href="#3-Method" class="headerlink" title="3. Method"></a>3. Method</h3><ol>
<li><p>指的是第一个参数是self的函数。其类型是 <code>Self</code> ， <code>&amp;Self</code>或 <code>&amp;mut Self</code>。也可以被Box，Rc，Arc或Pin来包装。</p>
</li>
<li><p>通过 TraitName::func() 方式调用，或者 &lt;实现trait类型的实例&gt;.func() 调用</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> five = <span class="hljs-built_in">ToString</span>::to_string(&amp;<span class="hljs-number">5</span>);<br>    <span class="hljs-keyword">let</span> five = <span class="hljs-built_in">i32</span>::to_string(&amp;<span class="hljs-number">5</span>);<br>&#125;<br><span class="hljs-comment">// 5这里是i32类型，i32类型实现了ToString trait</span><br><span class="hljs-comment">// https://doc.rust-lang.org/std/string/trait.ToString.html</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> five = <span class="hljs-number">5</span>.to_string();<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="4-Associated-Types-关联类型"><a href="#4-Associated-Types-关联类型" class="headerlink" title="4. Associated Types 关联类型"></a>4. Associated Types 关联类型</h3><ol>
<li><p>每个类型对这个trait的实现中，可以由实现者指定func中某个参数的类型</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Trait</span></span> &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">AssociatedType</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func</span></span>(arg: Self::AssociatedType);<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SomeType</span></span>;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">OtherType</span></span>;<br><br><span class="hljs-comment">// any type implementing Trait can</span><br><span class="hljs-comment">// choose the type of AssociatedType</span><br><br><span class="hljs-keyword">impl</span> Trait <span class="hljs-keyword">for</span> SomeType &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">AssociatedType</span></span> = <span class="hljs-built_in">i8</span>; <span class="hljs-comment">// chooses i8</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func</span></span>(arg: Self::AssociatedType) &#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> Trait <span class="hljs-keyword">for</span> OtherType &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">AssociatedType</span></span> = <span class="hljs-built_in">u8</span>; <span class="hljs-comment">// chooses u8</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func</span></span>(arg: Self::AssociatedType) &#123;&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    SomeType::func(-<span class="hljs-number">1_i8</span>); <span class="hljs-comment">// can only call func with i8 on SomeType</span><br>    OtherType::func(<span class="hljs-number">1_u8</span>); <span class="hljs-comment">// can only call func with u8 on OtherType</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="5-Generic-Parameters-泛型参数"><a href="#5-Generic-Parameters-泛型参数" class="headerlink" title="5. Generic Parameters 泛型参数"></a>5. Generic Parameters 泛型参数</h3><ol>
<li><p>“泛型参数”泛指</p>
<ol>
<li>泛型类型参数（generic type parameters）</li>
<li>泛型生命周期参数（generic lifetime parameters）</li>
<li>泛型常量参数（generic const parameters）</li>
</ol>
</li>
<li><p>因为这些说起来比较拗口，所以人们通常把它们简称为 “泛型类型（generic type）”、“生命周期（lifetime）”和 “泛型常量（generic const）”。</p>
</li>
<li><p>本文不讨论泛型常量</p>
</li>
<li><p>一个泛型类型 + 生命周期的例子，可以通过&lt;T &#x3D; i32&gt; 的方式赋默认类型</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// trait declaration generalized with lifetime &amp; type parameters</span><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Trait</span></span>&lt;<span class="hljs-symbol">&#x27;a</span>, T&gt; &#123;<br>    <span class="hljs-comment">// signature uses generic type</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func1</span></span>(arg: T);<br><br>    <span class="hljs-comment">// signature uses lifetime</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func2</span></span>(arg: &amp;<span class="hljs-symbol">&#x27;a</span> <span class="hljs-built_in">i32</span>);<br><br>    <span class="hljs-comment">// signature uses generic type &amp; lifetime</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func3</span></span>(arg: &amp;<span class="hljs-symbol">&#x27;a</span> T);<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SomeType</span></span>;<br><br><span class="hljs-keyword">impl</span>&lt;<span class="hljs-symbol">&#x27;a</span>&gt; Trait&lt;<span class="hljs-symbol">&#x27;a</span>, <span class="hljs-built_in">i8</span>&gt; <span class="hljs-keyword">for</span> SomeType &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func1</span></span>(arg: <span class="hljs-built_in">i8</span>) &#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func2</span></span>(arg: &amp;<span class="hljs-symbol">&#x27;a</span> <span class="hljs-built_in">i32</span>) &#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func3</span></span>(arg: &amp;<span class="hljs-symbol">&#x27;a</span> <span class="hljs-built_in">i8</span>) &#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span>&lt;<span class="hljs-symbol">&#x27;b</span>&gt; Trait&lt;<span class="hljs-symbol">&#x27;b</span>, <span class="hljs-built_in">u8</span>&gt; <span class="hljs-keyword">for</span> SomeType &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func1</span></span>(arg: <span class="hljs-built_in">u8</span>) &#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func2</span></span>(arg: &amp;<span class="hljs-symbol">&#x27;b</span> <span class="hljs-built_in">i32</span>) &#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func3</span></span>(arg: &amp;<span class="hljs-symbol">&#x27;b</span> <span class="hljs-built_in">u8</span>) &#123;&#125;<br>&#125;<br><br><span class="hljs-comment">// any type can be used as the default</span><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Trait2</span></span>&lt;T = <span class="hljs-built_in">i32</span>&gt; &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func2</span></span>(t: T) &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>也可以只对trait中的单个函数&#x2F;方法泛型化</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Trait</span></span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func</span></span>&lt;<span class="hljs-symbol">&#x27;a</span>, T&gt;(t: &amp;<span class="hljs-symbol">&#x27;a</span> T);<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="6-泛型-vs-关联类型"><a href="#6-泛型-vs-关联类型" class="headerlink" title="6. 泛型 vs 关联类型"></a>6. 泛型 vs 关联类型</h3><p>相同点：</p>
<ul>
<li>都把在 trait 的函数和方法中使用哪种具体类型的决定权交给了实现者</li>
</ul>
<p>不同点：</p>
<ul>
<li>当每个类型只应该有 trait 的一个实现时，使用关联类型。</li>
<li>当每个类型可能会有 trait 的多个实现时，使用泛型类型。</li>
</ul>
<ol>
<li>一个例子 Point 类型实现了Add这个trait，目前实现采用了关联类型，因此只能实现对一个类型的add func 实现Point类型对i32类型的add 方法会报错 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Add</span></span> &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Rhs</span></span>;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Output</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">add</span></span>(<span class="hljs-keyword">self</span>, rhs: Self::Rhs) -&gt; Self::Output;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span>,<br>&#125;<br><br><span class="hljs-keyword">impl</span> Add <span class="hljs-keyword">for</span> Point &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Rhs</span></span> = Point;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Output</span></span> = Point;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">add</span></span>(<span class="hljs-keyword">self</span>, rhs: Point) -&gt; Point &#123;<br>        Point &#123;<br>            x: <span class="hljs-keyword">self</span>.x + rhs.x,<br>            y: <span class="hljs-keyword">self</span>.y + rhs.y,<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> Add <span class="hljs-keyword">for</span> Point &#123; <span class="hljs-comment">// ❌</span><br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Rhs</span></span> = <span class="hljs-built_in">i32</span>;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Output</span></span> = Point;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">add</span></span>(<span class="hljs-keyword">self</span>, rhs: <span class="hljs-built_in">i32</span>) -&gt; Point &#123;<br>        Point &#123;<br>            x: <span class="hljs-keyword">self</span>.x + rhs,<br>            y: <span class="hljs-keyword">self</span>.y + rhs,<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> p1 = Point &#123; x: <span class="hljs-number">1</span>, y: <span class="hljs-number">1</span> &#125;;<br>    <span class="hljs-keyword">let</span> p2 = Point &#123; x: <span class="hljs-number">2</span>, y: <span class="hljs-number">2</span> &#125;;<br>    <span class="hljs-keyword">let</span> p3 = p1.add(p2);<br>    <span class="hljs-built_in">assert_eq!</span>(p3.x, <span class="hljs-number">3</span>);<br>    <span class="hljs-built_in">assert_eq!</span>(p3.y, <span class="hljs-number">3</span>);<br><br>    <span class="hljs-keyword">let</span> p1 = Point &#123; x: <span class="hljs-number">1</span>, y: <span class="hljs-number">1</span> &#125;;<br>    <span class="hljs-keyword">let</span> int2 = <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">let</span> p3 = p1.add(int2); <span class="hljs-comment">// ❌</span><br>    <span class="hljs-built_in">assert_eq!</span>(p3.x, <span class="hljs-number">3</span>);<br>    <span class="hljs-built_in">assert_eq!</span>(p3.y, <span class="hljs-number">3</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
 所以这里需要使用泛型来支持“多个类型在trait中的func会有多个实现“ 这里output也是关联类型，因此所有func实现的Output只能是一个类型 如果实现“点 + 点 &#x3D; 线段”这种其他Output类型，则会报错。解决方法就是把Output也换成泛型 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Add</span></span>&lt;Rhs&gt; &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Output</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">add</span></span>(<span class="hljs-keyword">self</span>, rhs: Rhs) -&gt; Self::Output;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span>,<br>&#125;<br><br><span class="hljs-keyword">impl</span> Add&lt;Point&gt; <span class="hljs-keyword">for</span> Point &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Output</span></span> = <span class="hljs-keyword">Self</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">add</span></span>(<span class="hljs-keyword">self</span>, rhs: Point) -&gt; Self::Output &#123;<br>        Point &#123;<br>            x: <span class="hljs-keyword">self</span>.x + rhs.x,<br>            y: <span class="hljs-keyword">self</span>.y + rhs.y,<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> Add&lt;<span class="hljs-built_in">i32</span>&gt; <span class="hljs-keyword">for</span> Point &#123; <span class="hljs-comment">// ✅</span><br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Output</span></span> = <span class="hljs-keyword">Self</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">add</span></span>(<span class="hljs-keyword">self</span>, rhs: <span class="hljs-built_in">i32</span>) -&gt; Self::Output &#123;<br>        Point &#123;<br>            x: <span class="hljs-keyword">self</span>.x + rhs,<br>            y: <span class="hljs-keyword">self</span>.y + rhs,<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> p1 = Point &#123; x: <span class="hljs-number">1</span>, y: <span class="hljs-number">1</span> &#125;;<br>    <span class="hljs-keyword">let</span> p2 = Point &#123; x: <span class="hljs-number">2</span>, y: <span class="hljs-number">2</span> &#125;;<br>    <span class="hljs-keyword">let</span> p3 = p1.add(p2);<br>    <span class="hljs-built_in">assert_eq!</span>(p3.x, <span class="hljs-number">3</span>);<br>    <span class="hljs-built_in">assert_eq!</span>(p3.y, <span class="hljs-number">3</span>);<br><br>    <span class="hljs-keyword">let</span> p1 = Point &#123; x: <span class="hljs-number">1</span>, y: <span class="hljs-number">1</span> &#125;;<br>    <span class="hljs-keyword">let</span> int2 = <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">let</span> p3 = p1.add(int2); <span class="hljs-comment">// ✅</span><br>    <span class="hljs-built_in">assert_eq!</span>(p3.x, <span class="hljs-number">3</span>);<br>    <span class="hljs-built_in">assert_eq!</span>(p3.y, <span class="hljs-number">3</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="7-作用域"><a href="#7-作用域" class="headerlink" title="7. 作用域"></a>7. 作用域</h3><ol>
<li><p>Trait 只有被显式地导入，才能使用其中定义的func</p>
<p> 比如Read trait就需要导入才能用</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::fs::File;<br><span class="hljs-keyword">use</span> std::io;<br><span class="hljs-keyword">use</span> std::io::Read; <span class="hljs-comment">// ✅</span><br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() -&gt; <span class="hljs-built_in">Result</span>&lt;(), io::Error&gt; &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> file = File::open(<span class="hljs-string">&quot;Cargo.toml&quot;</span>)?;<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> buffer = <span class="hljs-built_in">String</span>::new();<br>    file.read_to_string(&amp;<span class="hljs-keyword">mut</span> buffer)?; <span class="hljs-comment">// ✅</span><br>    <span class="hljs-literal">Ok</span>(())<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>标准库预置是个例外，总是被隐式导入。（The standard library prelude）是标准库中的一个模块，也就是说，<code>std::prelude::v1</code>，它在每个其他模块的顶部被自动导入，即<code>use std::prelude::v1::*</code>。这样的话，下面这些 trait 就总会在作用域中，我们不需要自己显式地导入它们，因为它们是预置的一部分。</p>
<ul>
<li>AsMut</li>
<li>AsRef</li>
<li>Clone</li>
<li>Copy</li>
<li>Default</li>
<li>Drop</li>
<li>Eq</li>
<li>Fn</li>
<li>FnMut</li>
<li>FnOnce</li>
<li>From</li>
<li>Into</li>
<li>ToOwned</li>
<li>IntoIterator</li>
<li>Iterator</li>
<li>PartialEq</li>
<li>PartialOrd</li>
<li>Send</li>
<li>Sized</li>
<li>Sync</li>
<li>ToString</li>
<li>Ord</li>
</ul>
</li>
</ol>
<h3 id="8-派生宏（Derive-Macros）"><a href="#8-派生宏（Derive-Macros）" class="headerlink" title="8.  派生宏（Derive Macros）"></a>8.  派生宏（Derive Macros）</h3><p>标准库导出了一小部分派生宏，这么派生宏可以让我们可以便捷地在一个类型上实现 trait，前提是该类型的所有成员都实现了这个 trait。派生宏以它们所实现的 trait 来命名。</p>
<ul>
<li>Clone</li>
<li>Copy</li>
<li>Debug</li>
<li>Default</li>
<li>Eq</li>
<li>Hash</li>
<li>Ord</li>
<li>PartialEq</li>
<li>PartialOrd</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// macro derives Copy &amp; Clone impl for SomeType</span><br><span class="hljs-meta">#[derive(Copy, Clone)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SomeType</span></span>;<br></code></pre></td></tr></table></figure>

<h3 id="9-Default-impls-默认实现"><a href="#9-Default-impls-默认实现" class="headerlink" title="9. Default impls 默认实现"></a>9. Default impls 默认实现</h3><ol>
<li><p>trait可以为定义的函数&#x2F;方法提供默认实现</p>
<p> 标准库中的很多 trait 为很多它们的方法提供了默认实现。</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Trait</span></span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">method</span></span>(&amp;<span class="hljs-keyword">self</span>) &#123;<br>        <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;default impl&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SomeType</span></span>;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">OtherType</span></span>;<br><br><span class="hljs-comment">// use default impl for Trait::method</span><br><span class="hljs-keyword">impl</span> Trait <span class="hljs-keyword">for</span> SomeType &#123;&#125;<br><br><span class="hljs-keyword">impl</span> Trait <span class="hljs-keyword">for</span> OtherType &#123;<br>    <span class="hljs-comment">// use our own impl for Trait::method</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">method</span></span>(&amp;<span class="hljs-keyword">self</span>) &#123;<br>        <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;OtherType impl&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    SomeType.method(); <span class="hljs-comment">// prints &quot;default impl&quot;</span><br>    OtherType.method(); <span class="hljs-comment">// prints &quot;OtherType impl&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="10-Generic-Blanket-Impls-泛型覆盖实现"><a href="#10-Generic-Blanket-Impls-泛型覆盖实现" class="headerlink" title="10. Generic Blanket Impls 泛型覆盖实现"></a>10. <strong><a target="_blank" rel="noopener" href="https://rustmagazine.github.io/rust_magazine_2021/chapter_7/rusts-standard-library-traits.html#%E6%B3%9B%E5%9E%8B%E8%A6%86%E7%9B%96%E5%AE%9E%E7%8E%B0generic-blanket-impls">Generic Blanket Impls</a> 泛型覆盖实现</strong></h3><ol>
<li>trait中的方法&#x2F;函数可以定义一个泛型实现<ol>
<li><p>一个例子</p>
<ol>
<li>类型T满足<code>Rem&lt;Output = T&gt; + PartialEq&lt;T&gt; + Sized,</code> 且类型u8可以转换为类型T</li>
</ol>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-meta">#![allow(unused)]</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br><span class="hljs-keyword">use</span> std::fmt::<span class="hljs-built_in">Debug</span>;<br><span class="hljs-keyword">use</span> std::convert::TryInto;<br><span class="hljs-keyword">use</span> std::ops::Rem;<br><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Even</span></span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_even</span></span>(<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">bool</span>;<br>&#125;<br><br><span class="hljs-comment">// generic blanket impl</span><br><span class="hljs-keyword">impl</span>&lt;T&gt; Even <span class="hljs-keyword">for</span> T<br><span class="hljs-keyword">where</span><br>    T: Rem&lt;Output = T&gt; + <span class="hljs-built_in">PartialEq</span>&lt;T&gt; + <span class="hljs-built_in">Sized</span>,<br>    <span class="hljs-built_in">u8</span>: TryInto&lt;T&gt;,<br>    &lt;<span class="hljs-built_in">u8</span> <span class="hljs-keyword">as</span> TryInto&lt;T&gt;&gt;::Error: <span class="hljs-built_in">Debug</span>,<br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_even</span></span>(<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">bool</span> &#123;<br>        <span class="hljs-comment">// these unwraps will never panic</span><br>        <span class="hljs-keyword">self</span> % <span class="hljs-number">2</span>.try_into().unwrap() == <span class="hljs-number">0</span>.try_into().unwrap()<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">#[test]</span> <span class="hljs-comment">// ✅</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">test_is_even</span></span>() &#123;<br>    <span class="hljs-built_in">assert!</span>(<span class="hljs-number">2_i8</span>.is_even());<br>    <span class="hljs-built_in">assert!</span>(<span class="hljs-number">4_u8</span>.is_even());<br>    <span class="hljs-built_in">assert!</span>(<span class="hljs-number">6_i16</span>.is_even());<br>    <span class="hljs-comment">// etc</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>泛型覆盖实现提供了方法的实现，所以它们不能被重写。</p>
<p> trait 一致性是指，对于任意给定的类型，最多存在某一 trait 的一个实现。Rust 用来强制执行特质一致性的规则，这些规则的含义，以及针对这些含义的变通方案都不在本文的讨论范围之内。</p>
</li>
</ol>
</li>
</ol>
<h3 id="11-Subtraits-amp-Supertraits"><a href="#11-Subtraits-amp-Supertraits" class="headerlink" title="11. Subtraits &amp; Supertraits"></a>11. <strong><a target="_blank" rel="noopener" href="https://rustmagazine.github.io/rust_magazine_2021/chapter_7/rusts-standard-library-traits.html#subtraits--supertraits">Subtraits &amp; Supertraits</a></strong></h3><p>子集、超集</p>
<ol>
<li><p>考虑如下的例子</p>
<ol>
<li>所有实现了Subtrait的类型是所有实现了Supertrait的类型的子集，或者反过来讲：所有实现了Supertrait的类型是所有实现了Subtrait类型的子集。</li>
</ol>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Subtrait</span></span>: Supertrait &#123;&#125;<br></code></pre></td></tr></table></figure>
<p> 它等于</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Subtrait</span></span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">Self</span>: Supertrait &#123;&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>子集和超集说的是的是实现trait的类型：</p>
<ol>
<li>也就是说约束在<code>Self</code>上：实现<code>Subtrait</code>的类型</li>
</ol>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Supertrait</span></span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">method</span></span>(&amp;<span class="hljs-keyword">self</span>) &#123;<br>        <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;in supertrait&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Subtrait</span></span>: Supertrait &#123;<br>    <span class="hljs-comment">// this looks like it might impl or</span><br>    <span class="hljs-comment">// override Supertrait::method but it</span><br>    <span class="hljs-comment">// does not</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">method</span></span>(&amp;<span class="hljs-keyword">self</span>) &#123;<br>        <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;in subtrait&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SomeType</span></span>;<br><br><span class="hljs-comment">// adds Supertrait::method to SomeType</span><br><span class="hljs-keyword">impl</span> Supertrait <span class="hljs-keyword">for</span> SomeType &#123;&#125;<br><br><span class="hljs-comment">// adds Subtrait::method to SomeType</span><br><span class="hljs-keyword">impl</span> Subtrait <span class="hljs-keyword">for</span> SomeType &#123;&#125;<br><br><span class="hljs-comment">// both methods exist on SomeType simultaneously</span><br><span class="hljs-comment">// neither overriding or shadowing the other</span><br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    SomeType.method(); <span class="hljs-comment">// ❌ ambiguous method call</span><br>    <span class="hljs-comment">// must disambiguate using fully-qualified syntax</span><br>    &lt;SomeType <span class="hljs-keyword">as</span> Supertrait&gt;::method(&amp;st); <span class="hljs-comment">// ✅ prints &quot;in supertrait&quot;</span><br>    &lt;SomeType <span class="hljs-keyword">as</span> Subtrait&gt;::method(&amp;st); <span class="hljs-comment">// ✅ prints &quot;in subtrait&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>需要区分：对泛型进行约束</p>
<ol>
<li><p>下面例子中，t的类型T一定实现了Clone Trait，或者说“类型T依赖Clone trait”，称为：泛型依赖于 trait 约束。</p>
<ol>
<li>在function中，t.clone() 可以被调用（定义在Clone trait的func都可以被调用）</li>
</ol>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">function</span></span>&lt;T: <span class="hljs-built_in">Clone</span>&gt;(t: T) &#123;<br>    <span class="hljs-comment">// impl</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>子集和超集</p>
<ol>
<li><p>Copy Trait 的例子</p>
<ol>
<li><p>Copy是Clone的子集，Copy并不依赖Clone</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Copy</span></span>: <span class="hljs-built_in">Clone</span> &#123;&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>可以这么理解：subtrait 细化（refine）了它们的 supertrait。</p>
<p> “细化（Refinement）”刻意保持一定的模糊性，因为它们在不同的上下文环境中会有不同的含义：</p>
<ul>
<li>subtrait 可能会使得 supertrait 的方法实现更为具体，快速，占用更少的内存，例如，<code>Copy:Clone</code>；</li>
<li>subtrait 可能会对 supertrait 的方法实现增加额外的保证，例如：<code>Eq: PartialEq</code>,<code>Ord: PartialOrd</code>,<code>ExactSizeIterator: Iterator</code>;</li>
<li>subtrait 可能会使得 supertrait 的方法更为灵活和易于调用，例如：<code>FnMut: FnOnce</code>,<code>Fn: FnMut</code>;</li>
<li>subtrait 可能会扩展 supertrait 并添加新的方法，例如：<code>DoubleEndedIterator: Iterator</code>,<code>ExactSizeIterator: Iterator</code>。</li>
</ul>
</li>
</ol>
<blockquote>
<p>感觉这里的“细化”可以理解为“特例化” zelin 220513</p>
</blockquote>
</li>
</ol>
<h3 id="12-Trait对象"><a href="#12-Trait对象" class="headerlink" title="12. Trait对象"></a>12. Trait对象</h3><ol>
<li><p>泛型可以实现编译期多态，Trait对象可以实现运行时多态</p>
</li>
<li><p>一个使用trait对象是函数动态返回不同类型的例子</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">example</span></span>(condition: <span class="hljs-built_in">bool</span>, vec: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">i32</span>&gt;) -&gt; <span class="hljs-built_in">Box</span>&lt;<span class="hljs-keyword">dyn</span> <span class="hljs-built_in">Iterator</span>&lt;Item = <span class="hljs-built_in">i32</span>&gt;&gt; &#123;<br>    <span class="hljs-keyword">let</span> iter = vec.into_iter();<br>    <span class="hljs-keyword">if</span> condition &#123;<br>        <span class="hljs-comment">// Has type:</span><br>        <span class="hljs-comment">// Box&lt;Map&lt;IntoIter&lt;i32&gt;, Fn(i32) -&gt; i32&gt;&gt;</span><br>        <span class="hljs-comment">// But is cast to:</span><br>        <span class="hljs-comment">// Box&lt;dyn Iterator&lt;Item = i32&gt;&gt;</span><br>        <span class="hljs-built_in">Box</span>::new(iter.map(|n| n * <span class="hljs-number">2</span>))<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// Has type:</span><br>        <span class="hljs-comment">// Box&lt;Filter&lt;IntoIter&lt;i32&gt;, Fn(&amp;i32) -&gt; bool&gt;&gt;</span><br>        <span class="hljs-comment">// But is cast to:</span><br>        <span class="hljs-comment">// Box&lt;dyn Iterator&lt;Item = i32&gt;&gt;</span><br>        <span class="hljs-built_in">Box</span>::new(iter.filter(|&amp;n| n &gt;= <span class="hljs-number">2</span>))<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>一个使用trait对象在集合中存储不同类型的例子</p>
<p> 这些类型都实现了同一个trait</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-meta">#![allow(unused)]</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br><span class="hljs-keyword">use</span> std::<span class="hljs-built_in">f64</span>::consts::PI;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Circle</span></span> &#123;<br>    radius: <span class="hljs-built_in">f64</span>,<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Square</span></span> &#123;<br>    side: <span class="hljs-built_in">f64</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Shape</span></span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">area</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">f64</span>;<br>&#125;<br><br><span class="hljs-keyword">impl</span> Shape <span class="hljs-keyword">for</span> Circle &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">area</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">f64</span> &#123;<br>        PI * <span class="hljs-keyword">self</span>.radius * <span class="hljs-keyword">self</span>.radius<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> Shape <span class="hljs-keyword">for</span> Square &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">area</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">f64</span> &#123;<br>        <span class="hljs-keyword">self</span>.side * <span class="hljs-keyword">self</span>.side<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">get_total_area</span></span>(shapes: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">Box</span>&lt;<span class="hljs-keyword">dyn</span> Shape&gt;&gt;) -&gt; <span class="hljs-built_in">f64</span> &#123;<br>    shapes.into_iter().map(|s| s.area()).sum()<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">example</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> shapes: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">Box</span>&lt;<span class="hljs-keyword">dyn</span> Shape&gt;&gt; = <span class="hljs-built_in">vec!</span>[<br>        <span class="hljs-built_in">Box</span>::new(Circle &#123; radius: <span class="hljs-number">1.0</span> &#125;), <span class="hljs-comment">// Box&lt;Circle&gt; cast to Box&lt;dyn Shape&gt;</span><br>        <span class="hljs-built_in">Box</span>::new(Square &#123; side: <span class="hljs-number">1.0</span> &#125;), <span class="hljs-comment">// Box&lt;Square&gt; cast to Box&lt;dyn Shape&gt;</span><br>    ];<br>    <span class="hljs-built_in">assert_eq!</span>(PI + <span class="hljs-number">1.0</span>, get_total_area(shapes)); <span class="hljs-comment">// ✅</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Trait对象是没有大小的，所以必须用智能指针包裹trait对象</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Struct</span></span>;<br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Trait</span></span> &#123;&#125;<br><br><span class="hljs-comment">// regular struct</span><br>&amp;Struct<br><span class="hljs-built_in">Box</span>&lt;Struct&gt;<br>Rc&lt;Struct&gt;<br>Arc&lt;Struct&gt;<br><br><span class="hljs-comment">// trait objects</span><br>&amp;<span class="hljs-keyword">dyn</span> Trait<br><span class="hljs-built_in">Box</span>&lt;<span class="hljs-keyword">dyn</span> Trait&gt;<br>Rc&lt;<span class="hljs-keyword">dyn</span> Trait&gt;<br>Arc&lt;<span class="hljs-keyword">dyn</span> Trait&gt;<br></code></pre></td></tr></table></figure>
</li>
<li><p>不是所有的 trait 都可以被转成 trait 对象。当且仅当一个 trait 满足下面这些要求时，它才是对象安全的（object-safe）：</p>
<ul>
<li>trait 不要求<code>Self:Sized</code></li>
<li>trait 的所有方法都是对象安全的</li>
</ul>
<p> 当一个 trait 方法满足下面的要求时，该方法是对象安全的：</p>
<ul>
<li>方法要求<code>Self:Sized</code> 或者</li>
<li>方法在其接收者位置仅使用一个<code>Self</code>类型</li>
</ul>
</li>
</ol>
<h3 id="13-Maker-Traits"><a href="#13-Maker-Traits" class="headerlink" title="13. Maker Traits"></a>13. Maker Traits</h3><p>指的是没有trait item（项）的trait（即没有任何函数&#x2F;方法）</p>
<p>仅仅是“标记”功能：类型具有“某种属性”</p>
<p>Eq就是一个标记Trait，在PartialEq基础上标记了“额外具有反射性”</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// Impling PartialEq for a type promises</span><br><span class="hljs-comment">// that equality for the type has these properties:</span><br><span class="hljs-comment">// - symmetry: a == b implies b == a, and</span><br><span class="hljs-comment">// - transitivity: a == b &amp;&amp; b == c implies a == c</span><br><span class="hljs-comment">// But DOES NOT promise this property:</span><br><span class="hljs-comment">// - reflexivity: a == a</span><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">PartialEq</span></span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">eq</span></span>(&amp;<span class="hljs-keyword">self</span>, other: &amp;<span class="hljs-keyword">Self</span>) -&gt; <span class="hljs-built_in">bool</span>;<br>&#125;<br><br><span class="hljs-comment">// Eq has no trait items! The eq method is already</span><br><span class="hljs-comment">// declared by PartialEq, but &quot;impling&quot; Eq</span><br><span class="hljs-comment">// for a type promises this additional equality property:</span><br><span class="hljs-comment">// - reflexivity: a == a</span><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Eq</span></span>: <span class="hljs-built_in">PartialEq</span> &#123;&#125;<br><br><span class="hljs-comment">// f64 impls PartialEq but not Eq because NaN != NaN</span><br><span class="hljs-comment">// i32 impls PartialEq &amp; Eq because there&#x27;s no NaNs :)</span><br></code></pre></td></tr></table></figure>

<h3 id="14-Auto-Trait-自动Trait"><a href="#14-Auto-Trait-自动Trait" class="headerlink" title="14. Auto Trait: 自动Trait"></a>14. Auto Trait: 自动Trait</h3><ol>
<li><p>自动 Trait 是指如果一个类型的所有成员都实现了该 trait，该类型就会自动实现该 trait。</p>
</li>
<li><p>“成员（member）”的含义取决于类型，例如：结构体的字段、枚举的变量、数组的元素、元组的项，等等</p>
</li>
<li><p>自动 trait 必须是标记 trait，但不是所有标记trait都是自动trait</p>
</li>
<li><p>自动trait的例子</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// implemented for types which are safe to send between threads</span><br><span class="hljs-keyword">unsafe</span> auto <span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Send</span></span> &#123;&#125;<br><br><span class="hljs-comment">// implemented for types whose references are safe to send between threads</span><br><span class="hljs-keyword">unsafe</span> auto <span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Sync</span></span> &#123;&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="15-unsafe-Trait"><a href="#15-unsafe-Trait" class="headerlink" title="15. unsafe Trait"></a>15. unsafe Trait</h3><ol>
<li><p>trait 可以被标记为unsafe，指的是实现trait的时候可以带一些unsafe代码</p>
</li>
<li><p>Send Sync这两个Trait就是unsafe Trait。如果手动实现Send Sync这两个Trait的时候，需要加上unsafe</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// SomeType is not Send or Sync</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SomeType</span></span> &#123;<br>    not_send_or_sync: *<span class="hljs-keyword">const</span> (),<br>&#125;<br><br><span class="hljs-comment">// but if we&#x27;re confident that our impl doesn&#x27;t have any data</span><br><span class="hljs-comment">// races we can explicitly mark it as Send and Sync using unsafe</span><br><span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">impl</span> <span class="hljs-built_in">Send</span> <span class="hljs-keyword">for</span> SomeType &#123;&#125;<br><span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">impl</span> <span class="hljs-built_in">Sync</span> <span class="hljs-keyword">for</span> SomeType &#123;&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="二、Auto-Trait"><a href="#二、Auto-Trait" class="headerlink" title="二、Auto Trait"></a>二、Auto Trait</h2><h3 id="1-Send-amp-Sync"><a href="#1-Send-amp-Sync" class="headerlink" title="1. Send &amp; Sync"></a>1. Send &amp; Sync</h3><ol>
<li><p>如果一个类型满足Send，说明该类型可以安全地在线程中发送（或者说移动）</p>
</li>
<li><p>如果一个类型满足Sync，说明该类型可以安全地在线程中共享引用</p>
</li>
<li><p>In more precise terms some type T is Sync if and only if &amp;T is Send.</p>
<p> 当且仅当&amp;T类型满足Send Trait，T才满足Sync Trait</p>
</li>
<li><p>几乎所有的类型都满足Send、Sync</p>
<ol>
<li>Send Trait例外：Rc<ol>
<li>线程安全的版本：Arc</li>
</ol>
</li>
<li>Sync Trait例外：Rc、Cell、RefCell<ol>
<li>线程安全的Cell&#x2F;RefCell : Mutex&#x2F;RwLock</li>
</ol>
</li>
<li>可以使用Mutex&#x2F;Rwlock包装原始类型获得原子性，也可以使用标准库提供的：AtomBool之类的原子类型</li>
</ol>
</li>
<li><p>即使没有任何内部同步的类型，由于Rust借用规则的保证，这个类型大概率格式满足Sync的</p>
<ol>
<li>一个例子，多个线程只读共享&amp;str 类型的 greeting_ref，<ol>
<li><p>在不可变引用仍存在时，不允许出现可变引用。</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> crossbeam::thread;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> greeting = <span class="hljs-built_in">String</span>::from(<span class="hljs-string">&quot;Hello&quot;</span>);<br>    <span class="hljs-keyword">let</span> greeting_ref = &amp;greeting;<br>    <br>    thread::scope(|scoped_thread| &#123;<br>        <span class="hljs-comment">// spawn 3 threads</span><br>        <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=<span class="hljs-number">3</span> &#123;<br>            <span class="hljs-comment">// greeting_ref copied into every thread</span><br>            scoped_thread.spawn(<span class="hljs-keyword">move</span> |_| &#123;<br>                <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;&#123;&#125; &#123;&#125;&quot;</span>, greeting_ref, n); <span class="hljs-comment">// prints &quot;Hello &#123;n&#125;&quot;</span><br>            &#125;);<br>        &#125;<br>        <br>        <span class="hljs-comment">// line below could cause UB or data races but compiler rejects it</span><br>        greeting += <span class="hljs-string">&quot; world&quot;</span>; <span class="hljs-comment">// ❌ cannot mutate greeting while immutable refs exist</span><br>    &#125;);<br>    <br>    <span class="hljs-comment">// can mutate greeting after every thread has joined</span><br>    greeting += <span class="hljs-string">&quot; world&quot;</span>; <span class="hljs-comment">// ✅</span><br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, greeting); <span class="hljs-comment">// prints &quot;Hello world&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<p> b. 也可以一个线程可写</p>
<p> 在一个可变引用存在的时候，不允许出现第二个可变引用</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> crossbeam::thread;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> greeting = <span class="hljs-built_in">String</span>::from(<span class="hljs-string">&quot;Hello&quot;</span>);<br>    <span class="hljs-keyword">let</span> greeting_ref = &amp;<span class="hljs-keyword">mut</span> greeting;<br>    <br>    thread::scope(|scoped_thread| &#123;<br>        <span class="hljs-comment">// greeting_ref moved into thread</span><br>        scoped_thread.spawn(<span class="hljs-keyword">move</span> |_| &#123;<br>            *greeting_ref += <span class="hljs-string">&quot; world&quot;</span>;<br>            <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, greeting_ref); <span class="hljs-comment">// prints &quot;Hello world&quot;</span><br>        &#125;);<br>        <br>        <span class="hljs-comment">// line below could cause UB or data races but compiler rejects it</span><br>        greeting += <span class="hljs-string">&quot;!!!&quot;</span>; <span class="hljs-comment">// ❌ cannot mutate greeting while mutable refs exist</span><br>    &#125;);<br>    <br>    <span class="hljs-comment">// can mutate greeting after the thread has joined</span><br>    greeting += <span class="hljs-string">&quot;!!!&quot;</span>; <span class="hljs-comment">// ✅</span><br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, greeting); <span class="hljs-comment">// prints &quot;Hello world!!!&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="2-Sized"><a href="#2-Sized" class="headerlink" title="2. Sized"></a>2. Sized</h3><ol>
<li><p>如果一个类型是<code>Sized</code>，这意味着它的类型大小在编译期是可知的，并且可以在栈上创建一个该类型的实例。</p>
</li>
<li><p>所有的泛型隐含了Sized Trait约束</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func</span></span>&lt;T&gt;(t: &amp;T) &#123;&#125;<br><br><span class="hljs-comment">// example above desugared</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func</span></span>&lt;T: <span class="hljs-built_in">Sized</span>&gt;(t: &amp;T) &#123;&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>因为所有的泛型类型上都有一个隐含的Sized约束，如果我们想要选择松弛这个约束，我们需要使用特定的“宽松约束（relaxed bound）”语法——?Sized，该语法目前只为Sized trait 存在。</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// now T can be unsized</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">func</span></span>&lt;T: ?<span class="hljs-built_in">Sized</span>&gt;(t: &amp;T) &#123;&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>所有的Trait隐含了<code>?size</code> 的约束</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Trait</span></span> &#123;&#125;<br><br><span class="hljs-comment">// example above desugared</span><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Trait</span></span>: ?<span class="hljs-built_in">Sized</span> &#123;&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h2 id="三、General-Traits"><a href="#三、General-Traits" class="headerlink" title="三、General Traits"></a>三、General Traits</h2><h3 id="1-Default"><a href="#1-Default" class="headerlink" title="1. Default"></a>1. Default</h3><ol>
<li><p>可以为实现Default的类型构造默认值</p>
<ol>
<li>注意default函数没有self参数，因为其功能就是创造一个类型实例</li>
</ol>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Color</span></span> &#123;<br>    r: <span class="hljs-built_in">u8</span>,<br>    g: <span class="hljs-built_in">u8</span>,<br>    b: <span class="hljs-built_in">u8</span>,<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">Default</span> <span class="hljs-keyword">for</span> Color &#123;<br>    <span class="hljs-comment">// default color is black</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">default</span></span>() -&gt; <span class="hljs-keyword">Self</span> &#123;<br>        Color &#123;<br>            r: <span class="hljs-number">0</span>,<br>            g: <span class="hljs-number">0</span>,<br>            b: <span class="hljs-number">0</span>,<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 默认值构造</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-comment">// just give me some color!</span><br>    <span class="hljs-keyword">let</span> color = Color::default();<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>default函数也可以用在泛型类型中</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">guarantee_length</span></span>&lt;T: <span class="hljs-built_in">Default</span>&gt;(<span class="hljs-keyword">mut</span> vec: <span class="hljs-built_in">Vec</span>&lt;T&gt;, min_len: <span class="hljs-built_in">usize</span>) -&gt; <span class="hljs-built_in">Vec</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..min_len.saturating_sub(vec.len()) &#123;<br>        vec.push(T::default());<br>    &#125;<br>    vec<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>也可以用派生宏的方式实现Default trait</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// default color is still black</span><br><span class="hljs-comment">// because u8::default() == 0</span><br><span class="hljs-meta">#[derive(Default)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Color</span></span> &#123;<br>    r: <span class="hljs-built_in">u8</span>,<br>    g: <span class="hljs-built_in">u8</span>,<br>    b: <span class="hljs-built_in">u8</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-Clone"><a href="#2-Clone" class="headerlink" title="2. Clone"></a>2. Clone</h3><p>预备知识</p>
<ol>
<li><p>Self指代实现的类型</p>
</li>
<li><p>Methods指对类型实例操作的函数</p>
</li>
<li><p><strong><strong>Default Impls 指Trait定义中可以包含函数&#x2F;方法的默认实现</strong></strong></p>
</li>
<li><p><strong><strong>Derive Macros 派生宏 指的是类型定义的时候可以通过派生宏的方式实现一个Trait</strong></strong></p>
</li>
<li><p>Clone trait中包含两个函数</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Clone</span></span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">clone</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-keyword">Self</span>;<br><br>    <span class="hljs-comment">// provided default impls</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">clone_from</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, source: &amp;<span class="hljs-keyword">Self</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Clone Trait的作用是，从一个不可变引用，转换为所拥有的值。即&amp;T-&gt;T。</p>
<ol>
<li>Clone不保证这种转换的效率，所以它会很慢并且成本较高。</li>
</ol>
</li>
<li><p>可以通过派生宏快速实现Clone Trait</p>
<ol>
<li>下面的例子中两种实现是等价的</li>
</ol>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-meta">#[derive(Clone)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SomeType</span></span> &#123;<br>    cloneable_member1: CloneableType1,<br>    cloneable_member2: CloneableType2,<br>    <span class="hljs-comment">// etc</span><br>&#125;<br><br><span class="hljs-comment">// macro generates impl below</span><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">Clone</span> <span class="hljs-keyword">for</span> SomeType &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">clone</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-keyword">Self</span> &#123;<br>        SomeType &#123;<br>            cloneable_member1: <span class="hljs-keyword">self</span>.cloneable_member1.clone(),<br>            cloneable_member2: <span class="hljs-keyword">self</span>.cloneable_member2.clone(),<br>            <span class="hljs-comment">// etc</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="3-Copy"><a href="#3-Copy" class="headerlink" title="3. Copy"></a>3. Copy</h3><p>预备知识</p>
<ol>
<li><p>标记Trait</p>
</li>
<li><p>子集和超集</p>
</li>
<li><p>派生宏</p>
</li>
<li><p>Copy Trait</p>
<ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Copy</span></span>: <span class="hljs-built_in">Clone</span> &#123;&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>作用</p>
<p> 按位拷贝，即T -&gt; T</p>
</li>
<li><p>实现</p>
<p> 只能通过派生宏实现，下面的两个实现是等价的</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-meta">#[derive(Copy, Clone)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SomeType</span></span>;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>Copy是Clone的子集：如果一个类型实现了Copy，那么这个类型自然满足Clone</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// this is what the derive macro generates</span><br><span class="hljs-keyword">impl</span>&lt;T: <span class="hljs-built_in">Copy</span>&gt; <span class="hljs-built_in">Clone</span> <span class="hljs-keyword">for</span> T &#123;<br>    <span class="hljs-comment">// the clone method becomes just a copy</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">clone</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-keyword">Self</span> &#123;<br>        *<span class="hljs-keyword">self</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>一个类型如果实现了Copy，它在被移动（move）时的行为就发生了改变。默认情况下，所有的类型都有移动（move）语义 ，但是一旦某个类型实现了Copy，它就有了拷贝（copy）语义 。</p>
<ol>
<li><p>一个例子，第一种情况下发生“移动”：src在移动后不可用。第二种情况发生“拷贝”：src在拷贝后仍有效</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// a &quot;move&quot;, src: !Copy</span><br><span class="hljs-keyword">let</span> dest = src;<br><br><span class="hljs-comment">// a &quot;copy&quot;, src: Copy</span><br><span class="hljs-keyword">let</span> dest = src;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Vec&lt;&gt; 类型只能移动，不能拷贝</p>
<ol>
<li><p>Vec<i32>类型如下</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs rust">&#123; data: *<span class="hljs-keyword">mut</span> [<span class="hljs-built_in">i32</span>], length: <span class="hljs-built_in">usize</span>, capacity: <span class="hljs-built_in">usize</span> &#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>如果允许Copy的话</p>
<p> src和dest就都有了数据的可变引用，这不满足Rust借用器检查</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs rust">src = &#123; data: *<span class="hljs-keyword">mut</span> [<span class="hljs-built_in">i32</span>], length: <span class="hljs-built_in">usize</span>, capacity: <span class="hljs-built_in">usize</span> &#125;<br>dest = &#123; data: *<span class="hljs-keyword">mut</span> [<span class="hljs-built_in">i32</span>], length: <span class="hljs-built_in">usize</span>, capacity: <span class="hljs-built_in">usize</span> &#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>Option&lt;&gt;类型也可以实现拷贝</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs rust">&#123; is_valid: <span class="hljs-built_in">bool</span>, data: <span class="hljs-built_in">i32</span> &#125;<br></code></pre></td></tr></table></figure>
<p> 拷贝后</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs rust">src = &#123; is_valid: <span class="hljs-built_in">bool</span>, data: <span class="hljs-built_in">i32</span> &#125;<br>dest = &#123; is_valid: <span class="hljs-built_in">bool</span>, data: <span class="hljs-built_in">i32</span> &#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>需要注意：Copy trait需要程序员显式地实现。</p>
</li>
</ol>
<h3 id="4-Any"><a href="#4-Any" class="headerlink" title="4. Any"></a>4. Any</h3><ol>
<li><p>预备知识</p>
<ol>
<li><strong>泛型覆盖实现，Trait定义的函数中，参数重满足一些Trait的类型，提供默认实现</strong></li>
</ol>
</li>
<li><p>Any Trait作用：实现“多态”的需求</p>
<ol>
<li>一个例子，从dyn Any类型中取出类型T需要使用<code>downcast_ref::&lt;T&gt;()</code> 和 <code>downcast_mut::&lt;T&gt;()</code> <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::any::Any;<br><br><span class="hljs-meta">#[derive(Default)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span>,<br>&#125;<br><br><span class="hljs-keyword">impl</span> Point &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">inc</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) &#123;<br>        <span class="hljs-keyword">self</span>.x += <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">self</span>.y += <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">map_any</span></span>(<span class="hljs-keyword">mut</span> any: <span class="hljs-built_in">Box</span>&lt;<span class="hljs-keyword">dyn</span> Any&gt;) -&gt; <span class="hljs-built_in">Box</span>&lt;<span class="hljs-keyword">dyn</span> Any&gt; &#123;<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Some</span>(num) = any.downcast_mut::&lt;<span class="hljs-built_in">i32</span>&gt;() &#123;<br>        *num += <span class="hljs-number">1</span>;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Some</span>(string) = any.downcast_mut::&lt;<span class="hljs-built_in">String</span>&gt;() &#123;<br>        *string += <span class="hljs-string">&quot;!&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Some</span>(point) = any.downcast_mut::&lt;Point&gt;() &#123;<br>        point.inc();<br>    &#125;<br>    any<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> vec: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">Box</span>&lt;<span class="hljs-keyword">dyn</span> Any&gt;&gt; = <span class="hljs-built_in">vec!</span>[<br>        <span class="hljs-built_in">Box</span>::new(<span class="hljs-number">0</span>),<br>        <span class="hljs-built_in">Box</span>::new(<span class="hljs-built_in">String</span>::from(<span class="hljs-string">&quot;a&quot;</span>)),<br>        <span class="hljs-built_in">Box</span>::new(Point::default()),<br>    ];<br>    <span class="hljs-comment">// vec = [0, &quot;a&quot;, Point &#123; x: 0, y: 0 &#125;]</span><br>    vec = vec.into_iter().map(map_any).collect();<br>    <span class="hljs-comment">// vec = [1, &quot;a!&quot;, Point &#123; x: 1, y: 1 &#125;]</span><br>&#125;<br></code></pre></td></tr></table></figure>
 但也可以通过参数化多态来实现多态 在大多数情况下，参数化多态要优于临时多态性，后者也可以用枚举（enum）来模拟，枚举具有更好的类型安全，需要的间接（抽象）也更少。 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-meta">#[derive(Default)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span>,<br>&#125;<br><br><span class="hljs-keyword">impl</span> Point &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">inc</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) &#123;<br>        <span class="hljs-keyword">self</span>.x += <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">self</span>.y += <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Stuff</span></span> &#123;<br>    Integer(<span class="hljs-built_in">i32</span>),<br>    <span class="hljs-built_in">String</span>(<span class="hljs-built_in">String</span>),<br>    Point(Point),<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">map_stuff</span></span>(<span class="hljs-keyword">mut</span> stuff: Stuff) -&gt; Stuff &#123;<br>    <span class="hljs-keyword">match</span> &amp;<span class="hljs-keyword">mut</span> stuff &#123;<br>        Stuff::Integer(num) =&gt; *num += <span class="hljs-number">1</span>,<br>        Stuff::<span class="hljs-built_in">String</span>(string) =&gt; *string += <span class="hljs-string">&quot;!&quot;</span>,<br>        Stuff::Point(point) =&gt; point.inc(),<br>    &#125;<br>    stuff<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> vec = <span class="hljs-built_in">vec!</span>[<br>        Stuff::Integer(<span class="hljs-number">0</span>),<br>        Stuff::<span class="hljs-built_in">String</span>(<span class="hljs-built_in">String</span>::from(<span class="hljs-string">&quot;a&quot;</span>)),<br>        Stuff::Point(Point::default()),<br>    ];<br>    <span class="hljs-comment">// vec = [0, &quot;a&quot;, Point &#123; x: 0, y: 0 &#125;]</span><br>    vec = vec.into_iter().map(map_stuff).collect();<br>    <span class="hljs-comment">// vec = [1, &quot;a!&quot;, Point &#123; x: 1, y: 1 &#125;]</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>Any Trait的实现</p>
<p> 不需要手动实现，均被“<strong>泛型覆盖实现</strong>”所覆盖</p>
<p> Any trait中仅包含一个type_id函数，标准库的默认实现已经覆盖了所有类型</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// https://doc.rust-lang.org/std/any/trait.Any.html</span><br><span class="hljs-meta">#[stable(feature = <span class="hljs-meta-string">&quot;rust1&quot;</span>, since = <span class="hljs-meta-string">&quot;1.0.0&quot;</span>)]</span><br><span class="hljs-meta">#[cfg_attr(not(test), rustc_diagnostic_item = <span class="hljs-meta-string">&quot;Any&quot;</span>)]</span><br><span class="hljs-keyword">pub</span> <span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Any</span></span>: <span class="hljs-symbol">&#x27;static</span> &#123;<br>    <span class="hljs-comment">/// Gets the `TypeId` of `self`.</span><br>    <span class="hljs-comment">///</span><br>    <span class="hljs-comment">/// # Examples</span><br>    <span class="hljs-comment">///</span><br>    <span class="hljs-comment">/// ```</span><br>    <span class="hljs-comment">/// use std::any::&#123;Any, TypeId&#125;;</span><br>    <span class="hljs-comment">///</span><br>    <span class="hljs-comment">/// fn is_string(s: &amp;dyn Any) -&gt; bool &#123;</span><br>    <span class="hljs-comment">///     TypeId::of::&lt;String&gt;() == s.type_id()</span><br>    <span class="hljs-comment">/// &#125;</span><br>    <span class="hljs-comment">///</span><br>    <span class="hljs-comment">/// assert_eq!(is_string(&amp;0), false);</span><br>    <span class="hljs-comment">/// assert_eq!(is_string(&amp;&quot;cookie monster&quot;.to_string()), true);</span><br>    <span class="hljs-comment">/// ```</span><br>    <span class="hljs-meta">#[stable(feature = <span class="hljs-meta-string">&quot;get_type_id&quot;</span>, since = <span class="hljs-meta-string">&quot;1.34.0&quot;</span>)]</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">type_id</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; TypeId;<br>&#125;<br><br><span class="hljs-meta">#[stable(feature = <span class="hljs-meta-string">&quot;rust1&quot;</span>, since = <span class="hljs-meta-string">&quot;1.0.0&quot;</span>)]</span><br><span class="hljs-keyword">impl</span>&lt;T: <span class="hljs-symbol">&#x27;static</span> + ?<span class="hljs-built_in">Sized</span>&gt; Any <span class="hljs-keyword">for</span> T &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">type_id</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; TypeId &#123;<br>        TypeId::of::&lt;T&gt;()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="四、Formatting-Trait"><a href="#四、Formatting-Trait" class="headerlink" title="四、Formatting Trait"></a>四、Formatting Trait</h2><table>
<thead>
<tr>
<th>Trait</th>
<th>Placeholder</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Display</td>
<td>{}</td>
<td>display representation</td>
</tr>
<tr>
<td>Debug</td>
<td>{:?}</td>
<td>debug representation</td>
</tr>
<tr>
<td>Octal</td>
<td>{:o}</td>
<td>octal representation</td>
</tr>
<tr>
<td>LowerHex</td>
<td>{:x}</td>
<td>lowercase hex representation</td>
</tr>
<tr>
<td>UpperHex</td>
<td>{:X}</td>
<td>uppercase hex representation</td>
</tr>
<tr>
<td>Pointer</td>
<td>{:p}</td>
<td>memory address</td>
</tr>
<tr>
<td>Binary</td>
<td>{:b}</td>
<td>binary representation</td>
</tr>
<tr>
<td>LowerExp</td>
<td>{:e}</td>
<td>lowercase exponential representation</td>
</tr>
<tr>
<td>UpperExp</td>
<td>{:E}</td>
<td>uppercase exponential representation</td>
</tr>
</tbody></table>
<h3 id="1-Display-Trait-amp-ToString-Trait"><a href="#1-Display-Trait-amp-ToString-Trait" class="headerlink" title="1. Display Trait &amp; ToString Trait"></a>1. Display Trait &amp; ToString Trait</h3><ol>
<li><p>Display trait</p>
<ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Display</span></span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">fmt</span></span>(&amp;<span class="hljs-keyword">self</span>, f: &amp;<span class="hljs-keyword">mut</span> Formatter&lt;<span class="hljs-symbol">&#x27;_</span>&gt;) -&gt; <span class="hljs-built_in">Result</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>作用：用户定义的类型想格式化打印的时候可以实现Display trait</p>
<p> 比如给Point 类型实现Display trait，实现后类型的实例就可以在格式化输出中输出为字符串</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::fmt;<br><br><span class="hljs-meta">#[derive(Default)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span>,<br>&#125;<br><br><span class="hljs-keyword">impl</span> fmt::Display <span class="hljs-keyword">for</span> Point &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">fmt</span></span>(&amp;<span class="hljs-keyword">self</span>, f: &amp;<span class="hljs-keyword">mut</span> fmt::Formatter&lt;<span class="hljs-symbol">&#x27;_</span>&gt;) -&gt; fmt::<span class="hljs-built_in">Result</span> &#123;<br>        <span class="hljs-built_in">write!</span>(f, <span class="hljs-string">&quot;(&#123;&#125;, &#123;&#125;)&quot;</span>, <span class="hljs-keyword">self</span>.x, <span class="hljs-keyword">self</span>.y)<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;origin: &#123;&#125;&quot;</span>, Point::default());<br>    <span class="hljs-comment">// prints &quot;origin: (0, 0)&quot;</span><br><br>    <span class="hljs-comment">// get Point&#x27;s Display representation as a String</span><br>    <span class="hljs-keyword">let</span> stringified_point = <span class="hljs-built_in">format!</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, Point::default());<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-string">&quot;(0, 0)&quot;</span>, stringified_point); <span class="hljs-comment">// ✅</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>ToString </p>
<ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">ToString</span></span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">to_string</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">String</span>;<br>&#125;<br><br><span class="hljs-keyword">impl</span>&lt;T: Display + ?<span class="hljs-built_in">Sized</span>&gt; <span class="hljs-built_in">ToString</span> <span class="hljs-keyword">for</span> T;<br></code></pre></td></tr></table></figure>
</li>
<li><p>所有实现Display Trait的类型都自动实现Tostring Trait（Again，泛型覆盖实现）</p>
</li>
<li><p>可以调用to_string 方法将对象转换为格式化打印</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-meta">#[test]</span> <span class="hljs-comment">// ✅</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">display_point</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> origin = Point::default();<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-built_in">format!</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, origin), <span class="hljs-string">&quot;(0, 0)&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">#[test]</span> <span class="hljs-comment">// ✅</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">point_to_string</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> origin = Point::default();<br>    <span class="hljs-built_in">assert_eq!</span>(origin.to_string(), <span class="hljs-string">&quot;(0, 0)&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">#[test]</span> <span class="hljs-comment">// ✅</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">display_equals_to_string</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> origin = Point::default();<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-built_in">format!</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, origin), origin.to_string());<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h3 id="2-Debug"><a href="#2-Debug" class="headerlink" title="2. Debug"></a>2. Debug</h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Debug</span></span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">fmt</span></span>(&amp;<span class="hljs-keyword">self</span>, f: &amp;<span class="hljs-keyword">mut</span> Formatter&lt;<span class="hljs-symbol">&#x27;_</span>&gt;) -&gt; <span class="hljs-built_in">Result</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>实现Debug Trait：可以通过派生宏，也可以自己定义输出</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs rust"><br><span class="hljs-meta">#[derive(Debug)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span>,<br>&#125;<br><br><span class="hljs-comment">// derive macro generates impl below</span><br><span class="hljs-keyword">impl</span> fmt::<span class="hljs-built_in">Debug</span> <span class="hljs-keyword">for</span> Point &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">fmt</span></span>(&amp;<span class="hljs-keyword">self</span>, f: &amp;<span class="hljs-keyword">mut</span> fmt::Formatter&lt;<span class="hljs-symbol">&#x27;_</span>&gt;) -&gt; fmt::<span class="hljs-built_in">Result</span> &#123;<br>        f.debug_struct(<span class="hljs-string">&quot;Point&quot;</span>)<br>            .field(<span class="hljs-string">&quot;x&quot;</span>, &amp;<span class="hljs-keyword">self</span>.x)<br>            .field(<span class="hljs-string">&quot;y&quot;</span>, &amp;<span class="hljs-keyword">self</span>.y)<br>            .finish()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>dbg! 输出和 print! 输出的区别</p>
<ul>
<li>dbg!打印到 stderr 而不是 stdout，因此在我们的程序中，能够很容易地和标准输出的输出结果区分。</li>
<li>dbg!会连同传入的表达式和表达式的计算结果一起打印出来。</li>
<li>dbg!会获取传入参数的所有权并将其返回，因此你可以在表达式中使用它：</li>
</ul>
</li>
</ol>
<h2 id="五、Opertor-Traits"><a href="#五、Opertor-Traits" class="headerlink" title="五、Opertor Traits"></a>五、Opertor Traits</h2><p>Rust中所有操作符均有一个Trait与之对应</p>
<table>
<thead>
<tr>
<th>Trait(s)</th>
<th>Category</th>
<th>Operator(s)</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Eq, PartialEq</td>
<td>comparison</td>
<td>&#x3D;&#x3D;</td>
<td>equality</td>
</tr>
<tr>
<td>Ord, PartialOrd</td>
<td>comparison</td>
<td>&lt;, &gt;, &lt;&#x3D;, &gt;&#x3D;</td>
<td>comparison</td>
</tr>
<tr>
<td>Add</td>
<td>arithmetic</td>
<td>+</td>
<td>addition</td>
</tr>
<tr>
<td>AddAssign</td>
<td>arithmetic</td>
<td>+&#x3D;</td>
<td>addition assignment</td>
</tr>
<tr>
<td>BitAnd</td>
<td>arithmetic</td>
<td>&amp;</td>
<td>bitwise AND</td>
</tr>
<tr>
<td>BitAndAssign</td>
<td>arithmetic</td>
<td>&amp;&#x3D;</td>
<td>bitwise assignment</td>
</tr>
<tr>
<td>BitXor</td>
<td>arithmetic</td>
<td>^</td>
<td>bitwise XOR</td>
</tr>
<tr>
<td>BitXorAssign</td>
<td>arithmetic</td>
<td>^&#x3D;</td>
<td>bitwise XOR assignment</td>
</tr>
<tr>
<td>Div</td>
<td>arithmetic</td>
<td>&#x2F;</td>
<td>division</td>
</tr>
<tr>
<td>DivAssign</td>
<td>arithmetic</td>
<td>&#x2F;&#x3D;</td>
<td>division assignment</td>
</tr>
<tr>
<td>Mul</td>
<td>arithmetic</td>
<td>*</td>
<td>multiplication</td>
</tr>
<tr>
<td>MulAssign</td>
<td>arithmetic</td>
<td>*&#x3D;</td>
<td>multiplication assignment</td>
</tr>
<tr>
<td>Neg</td>
<td>arithmetic</td>
<td>-</td>
<td>unary negation</td>
</tr>
<tr>
<td>Not</td>
<td>arithmetic</td>
<td>!</td>
<td>unary logical negation</td>
</tr>
<tr>
<td>Rem</td>
<td>arithmetic</td>
<td>%</td>
<td>remainder</td>
</tr>
<tr>
<td>RemAssign</td>
<td>arithmetic</td>
<td>%&#x3D;</td>
<td>remainder assignment</td>
</tr>
<tr>
<td>Shl</td>
<td>arithmetic</td>
<td>&lt;&lt;</td>
<td>left shift</td>
</tr>
<tr>
<td>ShlAssign</td>
<td>arithmetic</td>
<td>&lt;&lt;&#x3D;</td>
<td>left shift assignment</td>
</tr>
<tr>
<td>Shr</td>
<td>arithmetic</td>
<td>&gt;&gt;</td>
<td>right shift</td>
</tr>
<tr>
<td>ShrAssign</td>
<td>arithmetic</td>
<td>&gt;&gt;&#x3D;</td>
<td>right shift assignment</td>
</tr>
<tr>
<td>Sub</td>
<td>arithmetic</td>
<td>-</td>
<td>subtraction</td>
</tr>
<tr>
<td>SubAssign</td>
<td>arithmetic</td>
<td>-&#x3D;</td>
<td>subtraction assignment</td>
</tr>
<tr>
<td>Fn</td>
<td>closure</td>
<td>(…args)</td>
<td>immutable closure invocation</td>
</tr>
<tr>
<td>FnMut</td>
<td>closure</td>
<td>(…args)</td>
<td>mutable closure invocation</td>
</tr>
<tr>
<td>FnOnce</td>
<td>closure</td>
<td>(…args)</td>
<td>one-time closure invocation</td>
</tr>
<tr>
<td>Deref</td>
<td>other</td>
<td>*</td>
<td>immutable dereference</td>
</tr>
<tr>
<td>DerefMut</td>
<td>other</td>
<td>*</td>
<td>mutable derenence</td>
</tr>
<tr>
<td>Drop</td>
<td>other</td>
<td>-</td>
<td>type destructor</td>
</tr>
<tr>
<td>Index</td>
<td>other</td>
<td>[]</td>
<td>immutable index</td>
</tr>
<tr>
<td>IndexMut</td>
<td>other</td>
<td>[]</td>
<td>mutable index</td>
</tr>
<tr>
<td>RangeBounds</td>
<td>other</td>
<td>..</td>
<td>range</td>
</tr>
</tbody></table>
<p>下面逐个介绍</p>
<h3 id="1-Comparison-Traits"><a href="#1-Comparison-Traits" class="headerlink" title="1. Comparison Traits"></a>1. <strong><strong>Comparison Traits</strong></strong></h3><table>
<thead>
<tr>
<th>Trait(s)</th>
<th>Category</th>
<th>Operator(s)</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Eq, PartialEq</td>
<td>comparison</td>
<td>&#x3D;&#x3D;</td>
<td>equality</td>
</tr>
<tr>
<td>Ord, PartialOrd</td>
<td>comparison</td>
<td>&lt;, &gt;, &lt;&#x3D;, &gt;&#x3D;</td>
<td>comparison</td>
</tr>
</tbody></table>
<ol>
<li><p>PartialEq Trait</p>
<ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">PartialEq</span></span>&lt;Rhs = <span class="hljs-keyword">Self</span>&gt; <br><span class="hljs-keyword">where</span><br>    Rhs: ?<span class="hljs-built_in">Sized</span>, <br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">eq</span></span>(&amp;<span class="hljs-keyword">self</span>, other: &amp;Rhs) -&gt; <span class="hljs-built_in">bool</span>;<br><br>    <span class="hljs-comment">// provided default impls</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">ne</span></span>(&amp;<span class="hljs-keyword">self</span>, other: &amp;Rhs) -&gt; <span class="hljs-built_in">bool</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>作用</p>
<p> 满足PartialEq<Rhs>类型的实例可以通过&#x3D;&#x3D;操作符检查是否和Rhs类型的实例相等。</p>
</li>
<li><p>特点</p>
<ol>
<li>PartialEq表示的是集合论中的：对称性、传递性<ul>
<li>a &#x3D;&#x3D; b也意味着b &#x3D;&#x3D; a（对称性）</li>
<li>a &#x3D;&#x3D; b &amp;&amp; b &#x3D;&#x3D; c 意味着 a &#x3D;&#x3D; c （传递性）</li>
</ul>
</li>
</ol>
</li>
<li><p>实现</p>
<ol>
<li>如果一个类型中所有成员均实现了PartialEq，那么这个类型的PartialEq Trait可以被派生宏实现</li>
</ol>
</li>
<li><p>引用类型的实现</p>
<ol>
<li><p>again，由于”泛型覆盖实现”的特性，一旦一个类型满足了PartialEq trait，那么对应的引用类型的比较也自然被实现了，换句话说，该类型的引用类型也可以被比较了。</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// this impl only gives us: Point == Point</span><br><span class="hljs-meta">#[derive(PartialEq)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span><br>&#125;<br><br><span class="hljs-comment">// all of the generic blanket impls below</span><br><span class="hljs-comment">// are provided by the standard library</span><br><br><span class="hljs-comment">// this impl gives us: &amp;Point == &amp;Point</span><br><span class="hljs-keyword">impl</span>&lt;A, B&gt; <span class="hljs-built_in">PartialEq</span>&lt;&amp;<span class="hljs-symbol">&#x27;_</span> B&gt; <span class="hljs-keyword">for</span> &amp;<span class="hljs-symbol">&#x27;_</span> A<br><span class="hljs-keyword">where</span> A: <span class="hljs-built_in">PartialEq</span>&lt;B&gt; + ?<span class="hljs-built_in">Sized</span>, B: ?<span class="hljs-built_in">Sized</span>;<br><br><span class="hljs-comment">// this impl gives us: &amp;mut Point == &amp;Point</span><br><span class="hljs-keyword">impl</span>&lt;A, B&gt; <span class="hljs-built_in">PartialEq</span>&lt;&amp;<span class="hljs-symbol">&#x27;_</span> B&gt; <span class="hljs-keyword">for</span> &amp;<span class="hljs-symbol">&#x27;_</span> <span class="hljs-keyword">mut</span> A<br><span class="hljs-keyword">where</span> A: <span class="hljs-built_in">PartialEq</span>&lt;B&gt; + ?<span class="hljs-built_in">Sized</span>, B: ?<span class="hljs-built_in">Sized</span>;<br><br><span class="hljs-comment">// this impl gives us: &amp;Point == &amp;mut Point</span><br><span class="hljs-keyword">impl</span>&lt;A, B&gt; <span class="hljs-built_in">PartialEq</span>&lt;&amp;<span class="hljs-symbol">&#x27;_</span> <span class="hljs-keyword">mut</span> B&gt; <span class="hljs-keyword">for</span> &amp;<span class="hljs-symbol">&#x27;_</span> A<br><span class="hljs-keyword">where</span> A: <span class="hljs-built_in">PartialEq</span>&lt;B&gt; + ?<span class="hljs-built_in">Sized</span>, B: ?<span class="hljs-built_in">Sized</span>;<br><br><span class="hljs-comment">// this impl gives us: &amp;mut Point == &amp;mut Point</span><br><span class="hljs-keyword">impl</span>&lt;A, B&gt; <span class="hljs-built_in">PartialEq</span>&lt;&amp;<span class="hljs-symbol">&#x27;_</span> <span class="hljs-keyword">mut</span> B&gt; <span class="hljs-keyword">for</span> &amp;<span class="hljs-symbol">&#x27;_</span> <span class="hljs-keyword">mut</span> A<br><span class="hljs-keyword">where</span> A: <span class="hljs-built_in">PartialEq</span>&lt;B&gt; + ?<span class="hljs-built_in">Sized</span>, B: ?<span class="hljs-built_in">Sized</span>;<br></code></pre></td></tr></table></figure></li>
</ol>
<p> ii. 因为这个 trait 是泛型的，所以我们可以在不同的类型之间定义相等性（比较）。标准库利用这一点实现了类字符串类型之间的相互比较，比如String、&amp;str、PathBuf、&amp;Path、OsString、&amp;OsStr等等。</p>
</li>
</ol>
</li>
<li><p>Eq Trait</p>
<ol>
<li><p>定义</p>
<p> 是一个标记Trait，是PartialEq的子集</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Eq</span></span>: <span class="hljs-built_in">PartialEq</span>&lt;<span class="hljs-keyword">Self</span>&gt; &#123;&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>作用</p>
<p> 在PartialEq基础上要求“自反性”。也就是对于任意的a，都有a &#x3D;&#x3D; a。</p>
<p> 从这种意义上来说，Eq对PartialEq进行了细化，因为它表示了一个更为严格的相等性。</p>
</li>
<li><p>实现</p>
<p> 如果一个类型的所有成员都实现了Eq，那么Eq的实现可以派生到这个类型。</p>
<p> 浮点型实现了PartialEq但是没有实现Eq，因为NaN !&#x3D; NaN。几乎所有其他的实现了PartialEq的类型都实现了Eq，除非它们包含浮点类型。</p>
</li>
<li><p>备注：一旦一个类型实现了PartialEq和Debug，我们可以就可以在assert_eq!宏中使用它。</p>
<ol>
<li><p>还可以比较实现了PartialEq类型的集合。下面是一个例子</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-meta">#[derive(PartialEq, Debug)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span>,<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">example_assert</span></span>(p1: Point, p2: Point) &#123;<br>    <span class="hljs-built_in">assert_eq!</span>(p1, p2);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">example_compare_collections</span></span>&lt;T: <span class="hljs-built_in">PartialEq</span>&gt;(vec1: <span class="hljs-built_in">Vec</span>&lt;T&gt;, vec2: <span class="hljs-built_in">Vec</span>&lt;T&gt;) &#123;<br>    <span class="hljs-comment">// if T: PartialEq this now works!</span><br>    <span class="hljs-keyword">if</span> vec1 == vec2 &#123;<br>        <span class="hljs-comment">// some code</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// other code</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="2-Hash-Trait"><a href="#2-Hash-Trait" class="headerlink" title="2. Hash Trait"></a>2. Hash Trait</h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Hash</span></span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">hash</span></span>&lt;H: Hasher&gt;(&amp;<span class="hljs-keyword">self</span>, state: &amp;<span class="hljs-keyword">mut</span> H);<br><br>    <span class="hljs-comment">// provided default impls</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">hash_slice</span></span>&lt;H: Hasher&gt;(data: &amp;[<span class="hljs-keyword">Self</span>], state: &amp;<span class="hljs-keyword">mut</span> H);<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>作用</p>
<p> 满足Hash Trait的类型可以被满足Hasher trait的的对象计算哈希值</p>
<p> 也就可以放在HashMap HashSet 的Key中</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::hash::Hasher;<br><span class="hljs-keyword">use</span> std::hash::Hash;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span>,<br>&#125;<br><br><span class="hljs-keyword">impl</span> Hash <span class="hljs-keyword">for</span> Point &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">hash</span></span>&lt;H: Hasher&gt;(&amp;<span class="hljs-keyword">self</span>, hasher: &amp;<span class="hljs-keyword">mut</span> H) &#123;<br>        hasher.write_i32(<span class="hljs-keyword">self</span>.x);<br>        hasher.write_i32(<span class="hljs-keyword">self</span>.y);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>实现</p>
<p> 可以通过派生宏实现</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-meta">#[derive(Hash)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span>,<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>特点</p>
<ol>
<li>如果a &#x3D;&#x3D; b那么a.hash() &#x3D;&#x3D; b.hash()</li>
<li>如果一个类型的Eq Trait是派生宏实现的，Hash Trait也需要是被派生宏实现；或者二者可以均被手动实现。<ol>
<li>但不要混合，因为可能会破坏“如果a &#x3D;&#x3D; b那么a.hash() &#x3D;&#x3D; b.hash()” 的保证</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="3-PartialOrd"><a href="#3-PartialOrd" class="headerlink" title="3. PartialOrd"></a>3. <strong><strong>PartialOrd</strong></strong></h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Ordering</span></span> &#123;<br>    Less,<br>    Equal,<br>    Greater,<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">PartialOrd</span></span>&lt;Rhs = <span class="hljs-keyword">Self</span>&gt;: <span class="hljs-built_in">PartialEq</span>&lt;Rhs&gt; <br><span class="hljs-keyword">where</span><br>    Rhs: ?<span class="hljs-built_in">Sized</span>, <br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">partial_cmp</span></span>(&amp;<span class="hljs-keyword">self</span>, other: &amp;Rhs) -&gt; <span class="hljs-built_in">Option</span>&lt;Ordering&gt;;<br><br>    <span class="hljs-comment">// provided default impls</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">lt</span></span>(&amp;<span class="hljs-keyword">self</span>, other: &amp;Rhs) -&gt; <span class="hljs-built_in">bool</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">le</span></span>(&amp;<span class="hljs-keyword">self</span>, other: &amp;Rhs) -&gt; <span class="hljs-built_in">bool</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">gt</span></span>(&amp;<span class="hljs-keyword">self</span>, other: &amp;Rhs) -&gt; <span class="hljs-built_in">bool</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">ge</span></span>(&amp;<span class="hljs-keyword">self</span>, other: &amp;Rhs) -&gt; <span class="hljs-built_in">bool</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>作用</p>
<p> 满足PartialOrd<Rhs> Trait的类型可以通过 &lt;&#x2F; ≤&#x2F; &gt;&#x2F; ≥ 比较运算符和Rhs类型的实例比较大小</p>
</li>
<li><p>实现</p>
<ol>
<li><p>如果一个类型的所有成员都实现了PartialOrd，那么它就可以被派生实现</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-meta">#[derive(PartialEq, PartialOrd)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span>,<br>&#125;<br><br><span class="hljs-meta">#[derive(PartialEq, PartialOrd)]</span><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Stoplight</span></span> &#123;<br>    Red,<br>    Yellow,<br>    Green,<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>特点</p>
<ol>
<li><p>PartialOrd表示的是集合论的偏序</p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-cn/%E5%81%8F%E5%BA%8F%E5%85%B3%E7%B3%BB">https://zh.wikipedia.org/zh-cn/偏序关系</a></p>
<p>集合中上的一个关系，这个关系对于集合中的部分元素具有反对称性+传递性，那么这个关系在这个集合上就是偏序（PartialOrder，局部序）的</p>
<ol>
<li>a &lt; b implies !(a &gt; b) (asymmetry) 反对称性</li>
<li>a &lt; b &amp;&amp; b &lt; c implies a &lt; c (transitivity) 传递性</li>
</ol>
</li>
<li><p>PartialOrder Trait是PartialEq Trait的子集</p>
<ol>
<li><p>二者的实现必须等价</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">must_always_agree</span></span>&lt;T: <span class="hljs-built_in">PartialOrd</span> + <span class="hljs-built_in">PartialEq</span>&gt;(t1: T, t2: T) &#123;<br>    <span class="hljs-built_in">assert_eq!</span>(t1.partial_cmp(&amp;t2) == <span class="hljs-literal">Some</span>(Ordering::Equal), t1 == t2);<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>PartialOrder Trait 是在PartialEq Trait上的“特例化&#x2F;细化”</p>
<p> 满足PartialEq的类型只能比较相等&#x2F;不等；满足PartialOrder的类型也可以比较相等&#x2F;不相等，但是不等中还可以得出大于&#x2F;小于的结论</p>
</li>
</ol>
</li>
<li><p>派生宏实现的PartialOrder Trait，基于类型中成员变量的先后顺序比较的</p>
<p> 下面是个例子，前者先比较x，后者先比较y</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// generates PartialOrd impl which orders</span><br><span class="hljs-comment">// Points based on x member first and</span><br><span class="hljs-comment">// y member second because that&#x27;s the order</span><br><span class="hljs-comment">// they appear in the source code</span><br><span class="hljs-meta">#[derive(PartialOrd, PartialEq)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span>,<br>&#125;<br><br><span class="hljs-comment">// generates DIFFERENT PartialOrd impl</span><br><span class="hljs-comment">// which orders Points based on y member</span><br><span class="hljs-comment">// first and x member second</span><br><span class="hljs-meta">#[derive(PartialOrd, PartialEq)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    y: <span class="hljs-built_in">i32</span>,<br>    x: <span class="hljs-built_in">i32</span>,<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h3 id="4-Ord"><a href="#4-Ord" class="headerlink" title="4. Ord"></a>4. Ord</h3><ol>
<li><p>定义</p>
<p> Ord Trait是Eq Trait和PartialOrder Trait的子集</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Ord</span></span>: <span class="hljs-built_in">Eq</span> + <span class="hljs-built_in">PartialOrd</span>&lt;<span class="hljs-keyword">Self</span>&gt; &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">cmp</span></span>(&amp;<span class="hljs-keyword">self</span>, other: &amp;<span class="hljs-keyword">Self</span>) -&gt; Ordering;<br><br>    <span class="hljs-comment">// provided default impls</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">max</span></span>(<span class="hljs-keyword">self</span>, other: <span class="hljs-keyword">Self</span>) -&gt; <span class="hljs-keyword">Self</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">min</span></span>(<span class="hljs-keyword">self</span>, other: <span class="hljs-keyword">Self</span>) -&gt; <span class="hljs-keyword">Self</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">clamp</span></span>(<span class="hljs-keyword">self</span>, min: <span class="hljs-keyword">Self</span>, max: <span class="hljs-keyword">Self</span>) -&gt; <span class="hljs-keyword">Self</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>作用</p>
<ol>
<li>比较大小、在两个实例中找最大、最小</li>
<li>一旦一个类型实现了Ord，我们就可以把它存储在BTreeMap和BTreeSet，还可以在 slice 上使用 sort()方法对其进行排序，这同样适用于其他可以解引用为 slice 的类型，比如数组、Vec和VecDeque。</li>
</ol>
</li>
<li><p>实现</p>
<ol>
<li><p>通过派生宏&#x2F;手动实现</p>
<p> 这里注意，Ord Trait是PartialOrderTrait的子集，实现了Ord Trait后，PartialOrder的实现可以使用Ord Trait中的实现。</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::cmp::Ordering;<br><br><span class="hljs-comment">// of course we can use the derive macros here</span><br><span class="hljs-meta">#[derive(Ord, PartialOrd, Eq, PartialEq)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span>,<br>&#125;<br><br><span class="hljs-comment">// note: as with PartialOrd, the Ord derive macro</span><br><span class="hljs-comment">// orders a type based on the lexicographical order</span><br><span class="hljs-comment">// of its members</span><br><br><span class="hljs-comment">// but here&#x27;s the impls if we wrote them out by hand</span><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">Ord</span> <span class="hljs-keyword">for</span> Point &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">cmp</span></span>(&amp;<span class="hljs-keyword">self</span>, other: &amp;<span class="hljs-keyword">Self</span>) -&gt; Ordering &#123;<br>        <span class="hljs-keyword">match</span> <span class="hljs-keyword">self</span>.x.cmp(&amp;other.x) &#123;<br>            Ordering::Equal =&gt; <span class="hljs-keyword">self</span>.y.cmp(&amp;other.y),<br>            ordering =&gt; ordering,<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">PartialOrd</span> <span class="hljs-keyword">for</span> Point &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">partial_cmp</span></span>(&amp;<span class="hljs-keyword">self</span>, other: &amp;<span class="hljs-keyword">Self</span>) -&gt; <span class="hljs-built_in">Option</span>&lt;Ordering&gt; &#123;<br>        <span class="hljs-literal">Some</span>(<span class="hljs-keyword">self</span>.cmp(other))<br>    &#125;<br>&#125;<br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">PartialEq</span> <span class="hljs-keyword">for</span> Point &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">eq</span></span>(&amp;<span class="hljs-keyword">self</span>, other: &amp;<span class="hljs-keyword">Self</span>) -&gt; <span class="hljs-built_in">bool</span> &#123;<br>        <span class="hljs-keyword">self</span>.cmp(other) == Ordering::Equal<br>    &#125;<br>&#125;<br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">Eq</span> <span class="hljs-keyword">for</span> Point &#123;&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>特点</p>
<ol>
<li><p>表示集合论的全序</p>
<p> <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%85%A8%E5%BA%8F%E5%85%B3%E7%B3%BB">https://zh.wikipedia.org/wiki/全序关系</a></p>
<p> 集合中上的一个关系，这个关系对于集合中的所有元素均具有反对称性+传递性，那么这个关系在这个集合上就是全序（Order，全序）的</p>
<ol>
<li>a &lt; b implies !(a &gt; b) (asymmetry) 反对称性</li>
<li>a &lt; b &amp;&amp; b &lt; c implies a &lt; c (transitivity) 传递性</li>
</ol>
</li>
<li><p>Float 类型仅实现了PartialOrder Trait，但没有实现Order Trait</p>
<p> 因为NaN &lt; 0 &#x3D;&#x3D; false and NaN &gt;&#x3D; 0 &#x3D;&#x3D; false 这两个断言都是正确的，违反了对所有元素的“反对称性”</p>
</li>
</ol>
</li>
</ol>
<h3 id="5-Arithmetic-Traits"><a href="#5-Arithmetic-Traits" class="headerlink" title="5. Arithmetic Traits"></a>5. <strong><strong>Arithmetic Traits</strong></strong></h3><table>
<thead>
<tr>
<th>Trait(s)</th>
<th>Category</th>
<th>Operator(s)</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Add</td>
<td>arithmetic</td>
<td>+</td>
<td>addition</td>
</tr>
<tr>
<td>AddAssign</td>
<td>arithmetic</td>
<td>+&#x3D;</td>
<td>addition assignment</td>
</tr>
<tr>
<td>BitAnd</td>
<td>arithmetic</td>
<td>&amp;</td>
<td>bitwise AND</td>
</tr>
<tr>
<td>BitAndAssign</td>
<td>arithmetic</td>
<td>&amp;&#x3D;</td>
<td>bitwise assignment</td>
</tr>
<tr>
<td>BitXor</td>
<td>arithmetic</td>
<td>^</td>
<td>bitwise XOR</td>
</tr>
<tr>
<td>BitXorAssign</td>
<td>arithmetic</td>
<td>^&#x3D;</td>
<td>bitwise XOR assignment</td>
</tr>
<tr>
<td>Div</td>
<td>arithmetic</td>
<td>&#x2F;</td>
<td>division</td>
</tr>
<tr>
<td>DivAssign</td>
<td>arithmetic</td>
<td>&#x2F;&#x3D;</td>
<td>division assignment</td>
</tr>
<tr>
<td>Mul</td>
<td>arithmetic</td>
<td>*</td>
<td>multiplication</td>
</tr>
<tr>
<td>MulAssign</td>
<td>arithmetic</td>
<td>*&#x3D;</td>
<td>multiplication assignment</td>
</tr>
<tr>
<td>Neg</td>
<td>arithmetic</td>
<td>-</td>
<td>unary negation</td>
</tr>
<tr>
<td>Not</td>
<td>arithmetic</td>
<td>!</td>
<td>unary logical negation</td>
</tr>
<tr>
<td>Rem</td>
<td>arithmetic</td>
<td>%</td>
<td>remainder</td>
</tr>
<tr>
<td>RemAssign</td>
<td>arithmetic</td>
<td>%&#x3D;</td>
<td>remainder assignment</td>
</tr>
<tr>
<td>Shl</td>
<td>arithmetic</td>
<td>&lt;&lt;</td>
<td>left shift</td>
</tr>
<tr>
<td>ShlAssign</td>
<td>arithmetic</td>
<td>&lt;&lt;&#x3D;</td>
<td>left shift assignment</td>
</tr>
<tr>
<td>Shr</td>
<td>arithmetic</td>
<td>&gt;&gt;</td>
<td>right shift</td>
</tr>
<tr>
<td>ShrAssign</td>
<td>arithmetic</td>
<td>&gt;&gt;&#x3D;</td>
<td>right shift assignment</td>
</tr>
<tr>
<td>Sub</td>
<td>arithmetic</td>
<td>-</td>
<td>subtraction</td>
</tr>
<tr>
<td>SubAssign</td>
<td>arithmetic</td>
<td>-&#x3D;</td>
<td>subtraction assignment</td>
</tr>
</tbody></table>
<h3 id="6-Closure-Traits"><a href="#6-Closure-Traits" class="headerlink" title="6. Closure Traits"></a>6. <strong><strong>Closure Traits</strong></strong></h3><table>
<thead>
<tr>
<th>Trait(s)</th>
<th>Category</th>
<th>Operator(s)</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Fn</td>
<td>closure</td>
<td>(…args)</td>
<td>immutable closure invocation</td>
</tr>
<tr>
<td>FnMut</td>
<td>closure</td>
<td>(…args)</td>
<td>mutable closure invocation</td>
</tr>
<tr>
<td>FnOnce</td>
<td>closure</td>
<td>(…args)</td>
<td>one-time closure invocation</td>
</tr>
</tbody></table>
<p>包含三个Trait：Fn&#x2F;FnMut&#x2F;FnOnce</p>
<ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">FnOnce</span></span>&lt;Args&gt; &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Output</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">call_once</span></span>(<span class="hljs-keyword">self</span>, args: Args) -&gt; Self::Output;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">FnMut</span></span>&lt;Args&gt;: <span class="hljs-built_in">FnOnce</span>&lt;Args&gt; &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">call_mut</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, args: Args) -&gt; Self::Output;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Fn</span></span>&lt;Args&gt;: <span class="hljs-built_in">FnMut</span>&lt;Args&gt; &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">call</span></span>(&amp;<span class="hljs-keyword">self</span>, args: Args) -&gt; Self::Output;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>实现</p>
<p> 虽然存在这些 trait，但是在 stable 的 Rust 中，我们无法为自己的类型实现这些 trait。我们能够创建的唯一能够实现这些 trait 的类型就是闭包。闭包根据其从环境中所捕获的内容来决定它到底是实现FnOnce、FnMut还是Fn。</p>
</li>
<li><p>特点</p>
<ol>
<li><p>FnOnce只能被调用一次</p>
<p> 执行这个闭包的时候会“移动”一些值</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> range = <span class="hljs-number">0</span>..<span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">let</span> get_range_count = || range.count();<br>    <span class="hljs-built_in">assert_eq!</span>(get_range_count(), <span class="hljs-number">10</span>); <span class="hljs-comment">// ✅</span><br>    get_range_count(); <span class="hljs-comment">// ❌</span><br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>FnMut</p>
<ol>
<li><p>FnMut闭包可以被多次调用，并且可以修改它从环境中捕获到的变量。FnMut闭包是“有状态的”</p>
<p> 这是一个例子，闭包会修改外部的min，并将nums中所有不是升序的值删掉</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> nums = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>, <span class="hljs-number">7</span>, <span class="hljs-number">15</span>, <span class="hljs-number">18</span>, <span class="hljs-number">13</span>];<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> min = <span class="hljs-built_in">i32</span>::MIN;<br>    <span class="hljs-keyword">let</span> ascending = nums.into_iter().filter(|&amp;n| &#123;<br>        <span class="hljs-keyword">if</span> n &lt;= min &#123;<br>            <span class="hljs-literal">false</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            min = n;<br>            <span class="hljs-literal">true</span><br>        &#125;<br>    &#125;).collect::&lt;<span class="hljs-built_in">Vec</span>&lt;_&gt;&gt;();<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-built_in">vec!</span>[<span class="hljs-number">0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>, <span class="hljs-number">18</span>], ascending); <span class="hljs-comment">// ✅</span><br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>FnMut是FnOnce的子集，</p>
<ul>
<li>FnOnce会获取它的参数的所有权并且只能被调用一次，</li>
<li>FnMut仅要求获取参数的可变引用并且可以被多次调用，</li>
<li>FnMut细化了FnOnce。FnMut可以被用于任何可以使用FnOnce的地方。</li>
</ul>
</li>
</ol>
</li>
<li><p>Fn</p>
<ol>
<li><p>Fn闭包也可以被调用多次，但是不能修改外部环境的变量，但可以访问。Fn是“无状态”的</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> nums = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>, <span class="hljs-number">7</span>, <span class="hljs-number">15</span>, <span class="hljs-number">18</span>, <span class="hljs-number">13</span>];<br>    <span class="hljs-keyword">let</span> min = <span class="hljs-number">9</span>;<br>    <span class="hljs-keyword">let</span> greater_than_9 = nums.into_iter().filter(|&amp;n| n &gt; min).collect::&lt;<span class="hljs-built_in">Vec</span>&lt;_&gt;&gt;();<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-built_in">vec!</span>[<span class="hljs-number">10</span>, <span class="hljs-number">15</span>, <span class="hljs-number">18</span>, <span class="hljs-number">13</span>], greater_than_9); <span class="hljs-comment">// ✅</span><br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Fn是FnMut的子集</p>
<ul>
<li>FnMut要求可变引用并且可以被多次调用，</li>
<li>Fn只要求不可变引用并可以被多次调用，</li>
<li>Fn细化了FnMut。Fn可以被用于任何可以使用FnMut的地方，当然也包括可以使用FnOnce的地方。</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
<li><p>其他</p>
<ol>
<li>如果一个闭包不访问任何环境中的变量，从技术角度来讲它算不上是闭包，而只是一个被匿名声明的内联函数，并且可以作为一个普通函数指针（即Fn）被使用和传递，这包括可以使用FnMut和FnOnce的地方。 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">add_one</span></span>(x: <span class="hljs-built_in">i32</span>) -&gt; <span class="hljs-built_in">i32</span> &#123;<br>    x + <span class="hljs-number">1</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> fn_ptr: <span class="hljs-function"><span class="hljs-keyword">fn</span></span>(<span class="hljs-built_in">i32</span>) -&gt; <span class="hljs-built_in">i32</span> = add_one;<br>    <span class="hljs-built_in">assert_eq!</span>(fn_ptr(<span class="hljs-number">1</span>), <span class="hljs-number">2</span>); <span class="hljs-comment">// ✅</span><br>    <br>    <span class="hljs-comment">// capture-less closure cast to fn pointer</span><br>    fn_ptr = |x| x + <span class="hljs-number">1</span>; <span class="hljs-comment">// same as add_one</span><br>    <span class="hljs-built_in">assert_eq!</span>(fn_ptr(<span class="hljs-number">1</span>), <span class="hljs-number">2</span>); <span class="hljs-comment">// ✅</span><br>&#125;<br></code></pre></td></tr></table></figure>
 下面是一个传递普通函数指针而不是闭包的示例： <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> nums = <span class="hljs-built_in">vec!</span>[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, -<span class="hljs-number">3</span>, <span class="hljs-number">3</span>];<br>    <span class="hljs-keyword">let</span> absolutes: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">i32</span>&gt; = nums.into_iter().map(<span class="hljs-built_in">i32</span>::abs).collect();<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>], absolutes); <span class="hljs-comment">// ✅</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h3 id="7-Deref-Trait"><a href="#7-Deref-Trait" class="headerlink" title="7. Deref Trait"></a>7. Deref Trait</h3><table>
<thead>
<tr>
<th>Trait(s)</th>
<th>Category</th>
<th>Operator(s)</th>
<th>Description</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Deref</td>
<td>other</td>
<td>*</td>
<td>immutable dereference</td>
<td>不可变引用</td>
</tr>
<tr>
<td>DerefMut</td>
<td>other</td>
<td>*</td>
<td>mutable derenence</td>
<td>可变引用</td>
</tr>
</tbody></table>
<ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Deref</span></span> &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Target</span></span>: ?<span class="hljs-built_in">Sized</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">deref</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;Self::Target;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">DerefMut</span></span>: Deref &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">deref_mut</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-keyword">mut</span> Self::Target;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>功能</p>
<p> Deref&lt;Target &#x3D; T&gt;类型可以使用 * 操作符解引用为T类型。</p>
</li>
<li><p>特点</p>
<ol>
<li>当类型被作为函数参数传递、从函数返回或者作为方法调用的一部分时，Rust 会自动对这些类型进行解引用。<ol>
<li>我们可以在一个期望<code>&amp;str</code>和<code>&amp;[T]</code>的函数中可以传入<code>&amp;String</code>和<code>&amp;Vec&lt;T&gt;</code>，<ol>
<li><code>String</code>实现了<code>Deref&lt;Target = str&gt;</code></li>
<li><code>Vec&lt;T&gt;</code>实现了<code>Deref&lt;Target = [T]&gt;</code>。</li>
</ol>
</li>
</ol>
</li>
<li>Deref和DerefMut应该仅被实现于智能指针类型。</li>
<li>不要用deref来实现OOP的多态</li>
</ol>
</li>
</ol>
<h3 id="8-Index-amp-IndexMut"><a href="#8-Index-amp-IndexMut" class="headerlink" title="8. Index &amp; IndexMut"></a>8. <strong>Index &amp; IndexMut</strong></h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Index</span></span>&lt;Idx: ?<span class="hljs-built_in">Sized</span>&gt; &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Output</span></span>: ?<span class="hljs-built_in">Sized</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">index</span></span>(&amp;<span class="hljs-keyword">self</span>, index: Idx) -&gt; &amp;Self::Output;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">IndexMut</span></span>&lt;Idx&gt;: Index&lt;Idx&gt; <span class="hljs-keyword">where</span> Idx: ?<span class="hljs-built_in">Sized</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">index_mut</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, index: Idx) -&gt; &amp;<span class="hljs-keyword">mut</span> Self::Output;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>功能</p>
<ol>
<li>我们可以用[]索引具有 T 值的Index&lt;T, Output &#x3D; U&gt;类型，索引操作将返回&amp;U值。</li>
</ol>
</li>
<li><p>特点</p>
<ol>
<li><p>索引操作后，编译器默认在返回值前插入解引用</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-comment">// Vec&lt;i32&gt; impls Index&lt;usize, Output = i32&gt; so</span><br>    <span class="hljs-comment">// indexing Vec&lt;i32&gt; should produce &amp;i32s and yet...</span><br>    <span class="hljs-keyword">let</span> vec = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];<br>    <span class="hljs-keyword">let</span> num_ref: &amp;<span class="hljs-built_in">i32</span> = vec[<span class="hljs-number">0</span>]; <span class="hljs-comment">// ❌ expected &amp;i32 found i32</span><br>    <br>    <span class="hljs-comment">// above line actually desugars to</span><br>    <span class="hljs-keyword">let</span> num_ref: &amp;<span class="hljs-built_in">i32</span> = *vec[<span class="hljs-number">0</span>]; <span class="hljs-comment">// ❌ expected &amp;i32 found i32</span><br><br>    <span class="hljs-comment">// both of these alternatives work</span><br>    <span class="hljs-keyword">let</span> num: <span class="hljs-built_in">i32</span> = vec[<span class="hljs-number">0</span>]; <span class="hljs-comment">// ✅</span><br>    <span class="hljs-keyword">let</span> num_ref = &amp;vec[<span class="hljs-number">0</span>]; <span class="hljs-comment">// ✅</span><br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>用来索引的Idx是一个泛型，举几个其他类型用来索引的例子</p>
<ol>
<li><p>可以是usize</p>
</li>
<li><p>可以是其他整数类型</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::ops::Index;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">WrappingIndex</span></span>&lt;T&gt;(<span class="hljs-built_in">Vec</span>&lt;T&gt;);<br><br><span class="hljs-keyword">impl</span>&lt;T&gt; Index&lt;<span class="hljs-built_in">usize</span>&gt; <span class="hljs-keyword">for</span> WrappingIndex&lt;T&gt; &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Output</span></span> = T;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">index</span></span>(&amp;<span class="hljs-keyword">self</span>, index: <span class="hljs-built_in">usize</span>) -&gt; &amp;T &#123;<br>        &amp;<span class="hljs-keyword">self</span>.<span class="hljs-number">0</span>[index % <span class="hljs-keyword">self</span>.<span class="hljs-number">0</span>.len()]<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span>&lt;T&gt; Index&lt;<span class="hljs-built_in">i128</span>&gt; <span class="hljs-keyword">for</span> WrappingIndex&lt;T&gt; &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Output</span></span> = T;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">index</span></span>(&amp;<span class="hljs-keyword">self</span>, index: <span class="hljs-built_in">i128</span>) -&gt; &amp;T &#123;<br>        <span class="hljs-keyword">let</span> self_len = <span class="hljs-keyword">self</span>.<span class="hljs-number">0</span>.len() <span class="hljs-keyword">as</span> <span class="hljs-built_in">i128</span>;<br>        <span class="hljs-keyword">let</span> idx = (((index % self_len) + self_len) % self_len) <span class="hljs-keyword">as</span> <span class="hljs-built_in">usize</span>;<br>        &amp;<span class="hljs-keyword">self</span>.<span class="hljs-number">0</span>[idx]<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">#[test]</span> <span class="hljs-comment">// ✅</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">indexes</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> wrapping_vec = WrappingIndex(<span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">1</span>, wrapping_vec[<span class="hljs-number">0_usize</span>]);<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">2</span>, wrapping_vec[<span class="hljs-number">1_usize</span>]);<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">3</span>, wrapping_vec[<span class="hljs-number">2_usize</span>]);<br>&#125;<br><br><span class="hljs-meta">#[test]</span> <span class="hljs-comment">// ✅</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">wrapping_indexes</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> wrapping_vec = WrappingIndex(<span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">1</span>, wrapping_vec[<span class="hljs-number">3_usize</span>]);<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">2</span>, wrapping_vec[<span class="hljs-number">4_usize</span>]);<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">3</span>, wrapping_vec[<span class="hljs-number">5_usize</span>]);<br>&#125;<br><br><span class="hljs-meta">#[test]</span> <span class="hljs-comment">// ✅</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">neg_indexes</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> wrapping_vec = WrappingIndex(<span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">1</span>, wrapping_vec[-<span class="hljs-number">3_i128</span>]);<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">2</span>, wrapping_vec[-<span class="hljs-number">2_i128</span>]);<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">3</span>, wrapping_vec[-<span class="hljs-number">1_i128</span>]);<br>&#125;<br><br><span class="hljs-meta">#[test]</span> <span class="hljs-comment">// ✅</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">wrapping_neg_indexes</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> wrapping_vec = WrappingIndex(<span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">1</span>, wrapping_vec[-<span class="hljs-number">6_i128</span>]);<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">2</span>, wrapping_vec[-<span class="hljs-number">5_i128</span>]);<br>    <span class="hljs-built_in">assert_eq!</span>(<span class="hljs-number">3</span>, wrapping_vec[-<span class="hljs-number">4_i128</span>]);<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>可以是满足 Range<usize> 的类型</p>
<p> 下面这个例子中，1.. &#x2F;..4&#x2F;1..4 都是满足 Range<usize> 的类型</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> vec = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];<br>    <span class="hljs-built_in">assert_eq!</span>(&amp;vec[..], &amp;[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]); <span class="hljs-comment">// ✅</span><br>    <span class="hljs-built_in">assert_eq!</span>(&amp;vec[<span class="hljs-number">1</span>..], &amp;[<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]); <span class="hljs-comment">// ✅</span><br>    <span class="hljs-built_in">assert_eq!</span>(&amp;vec[..<span class="hljs-number">4</span>], &amp;[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]); <span class="hljs-comment">// ✅</span><br>    <span class="hljs-built_in">assert_eq!</span>(&amp;vec[<span class="hljs-number">1</span>..<span class="hljs-number">4</span>], &amp;[<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]); <span class="hljs-comment">// ✅</span><br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>可以是枚举</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::ops::Index;<br><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">BasketballPosition</span></span> &#123;<br>    PointGuard,<br>    ShootingGuard,<br>    Center,<br>    PowerForward,<br>    SmallForward,<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">BasketballPlayer</span></span> &#123;<br>    name: &amp;<span class="hljs-symbol">&#x27;static</span> <span class="hljs-built_in">str</span>,<br>    position: BasketballPosition,<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">BasketballTeam</span></span> &#123;<br>    point_guard: BasketballPlayer,<br>    shooting_guard: BasketballPlayer,<br>    center: BasketballPlayer,<br>    power_forward: BasketballPlayer,<br>    small_forward: BasketballPlayer,<br>&#125;<br><br><span class="hljs-keyword">impl</span> Index&lt;BasketballPosition&gt; <span class="hljs-keyword">for</span> BasketballTeam &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Output</span></span> = BasketballPlayer;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">index</span></span>(&amp;<span class="hljs-keyword">self</span>, position: BasketballPosition) -&gt; &amp;BasketballPlayer &#123;<br>        <span class="hljs-keyword">match</span> position &#123;<br>            BasketballPosition::PointGuard =&gt; &amp;<span class="hljs-keyword">self</span>.point_guard,<br>            BasketballPosition::ShootingGuard =&gt; &amp;<span class="hljs-keyword">self</span>.shooting_guard,<br>            BasketballPosition::Center =&gt; &amp;<span class="hljs-keyword">self</span>.center,<br>            BasketballPosition::PowerForward =&gt; &amp;<span class="hljs-keyword">self</span>.power_forward,<br>            BasketballPosition::SmallForward =&gt; &amp;<span class="hljs-keyword">self</span>.small_forward,<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="8-Drop-Trait"><a href="#8-Drop-Trait" class="headerlink" title="8. Drop Trait"></a>8. Drop Trait</h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Drop</span></span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">drop</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>作用</p>
<p> drop函数会在该类型离开作用域但是销毁之前被调用。用来销毁某些外部资源</p>
</li>
<li><p>例子</p>
<ol>
<li><p>标准库中有一个BufWriter类型让我们能够把写入的数据缓冲到Write类型中。</p>
<p> 为了避免Bufwriter的内容在写入底层write类型之前就被销毁，Bufwirter实现了Drop Trait</p>
<p> 让Bufwriter对象在销毁前保证刷新缓冲区</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">impl</span>&lt;W: Write&gt; <span class="hljs-built_in">Drop</span> <span class="hljs-keyword">for</span> BufWriter&lt;W&gt; &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">drop</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) &#123;<br>        <span class="hljs-keyword">self</span>.flush_buf();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Rust 中的Mutexs没有unlock()方法，因为它们不需要！</p>
<ol>
<li>在Mutex上调用lock()会返回一个MutexGuard，</li>
<li>当MutexGuard离开作用域时，它会调用drop函数自动解锁（unlock）Mutex，</li>
</ol>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">impl</span>&lt;T: ?<span class="hljs-built_in">Sized</span>&gt; <span class="hljs-built_in">Drop</span> <span class="hljs-keyword">for</span> MutexGuard&lt;<span class="hljs-symbol">&#x27;_</span>, T&gt; &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">drop</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) &#123;<br>        <span class="hljs-keyword">unsafe</span> &#123;<br>            <span class="hljs-keyword">self</span>.lock.inner.raw_unlock();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h2 id="六、Conversion-Traits"><a href="#六、Conversion-Traits" class="headerlink" title="六、Conversion Traits"></a>六、<strong><strong>Conversion Traits</strong></strong></h2><h3 id="1-From-amp-Into"><a href="#1-From-amp-Into" class="headerlink" title="1. From&amp;Into"></a>1. From&amp;Into</h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">From</span></span>&lt;T&gt; &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">from</span></span>(T) -&gt; <span class="hljs-keyword">Self</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Into</span></span>&lt;T&gt; &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">into</span></span>(<span class="hljs-keyword">self</span>) -&gt; T;<br>&#125;<br><br><span class="hljs-keyword">impl</span>&lt;T, U&gt; <span class="hljs-built_in">Into</span>&lt;U&gt; <span class="hljs-keyword">for</span> T<br><span class="hljs-keyword">where</span><br>    U: <span class="hljs-built_in">From</span>&lt;T&gt;,<br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">into</span></span>(<span class="hljs-keyword">self</span>) -&gt; U &#123;<br>        U::from(<span class="hljs-keyword">self</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>作用</p>
<ol>
<li>From Trait允许把T类型转换为Self类型（通常为自己实现的类型）</li>
<li>只能为自己的类型实现From<T>，因为Into<T>的实现会通过 generic blanket impl 自动提供</li>
</ol>
</li>
<li><p>使用例子</p>
<ol>
<li><p>基础例子</p>
<ol>
<li><p>可以从（x,y）tuple或者 array 转换为Point类型</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span>,<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">From</span>&lt;(<span class="hljs-built_in">i32</span>, <span class="hljs-built_in">i32</span>)&gt; <span class="hljs-keyword">for</span> Point &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">from</span></span>((x, y): (<span class="hljs-built_in">i32</span>, <span class="hljs-built_in">i32</span>)) -&gt; <span class="hljs-keyword">Self</span> &#123;<br>        Point &#123; x, y &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">From</span>&lt;Point&gt; <span class="hljs-keyword">for</span> (<span class="hljs-built_in">i32</span>, <span class="hljs-built_in">i32</span>) &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">from</span></span>(Point &#123; x, y &#125;: Point) -&gt; <span class="hljs-keyword">Self</span> &#123;<br>        (x, y)<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">From</span>&lt;[<span class="hljs-built_in">i32</span>; <span class="hljs-number">2</span>]&gt; <span class="hljs-keyword">for</span> Point &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">from</span></span>([x, y]: [<span class="hljs-built_in">i32</span>; <span class="hljs-number">2</span>]) -&gt; <span class="hljs-keyword">Self</span> &#123;<br>        Point &#123; x, y &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">From</span>&lt;Point&gt; <span class="hljs-keyword">for</span> [<span class="hljs-built_in">i32</span>; <span class="hljs-number">2</span>] &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">from</span></span>(Point &#123; x, y &#125;: Point) -&gt; <span class="hljs-keyword">Self</span> &#123;<br>        [x, y]<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">example</span></span>() &#123;<br>    <span class="hljs-comment">// 从 (i32, i32) 到 Point</span><br>    <span class="hljs-keyword">let</span> point = Point::from((<span class="hljs-number">0</span>, <span class="hljs-number">0</span>));<br>    <span class="hljs-keyword">let</span> point: Point = (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>).into();<br><br>    <span class="hljs-comment">// 从 Point 到 (i32, i32)</span><br>    <span class="hljs-keyword">let</span> tuple = &lt;(<span class="hljs-built_in">i32</span>, <span class="hljs-built_in">i32</span>)&gt;::from(point);<br>    <span class="hljs-keyword">let</span> tuple: (<span class="hljs-built_in">i32</span>, <span class="hljs-built_in">i32</span>) = point.into();<br><br>    <span class="hljs-comment">// 从 [i32; 2] 到 Point</span><br>    <span class="hljs-keyword">let</span> point = Point::from([<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]);<br>    <span class="hljs-keyword">let</span> point: Point = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>].into();<br><br>    <span class="hljs-comment">// 从 Point 到 [i32; 2]</span><br>    <span class="hljs-keyword">let</span> array = &lt;[<span class="hljs-built_in">i32</span>; <span class="hljs-number">2</span>]&gt;::from(point);<br>    <span class="hljs-keyword">let</span> array: [<span class="hljs-built_in">i32</span>; <span class="hljs-number">2</span>] = point.into();<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>使得“需要对参数拥有所有权的”函数具有通用型，不关心传进来的参数是拥有值还是值得引用</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Person</span></span> &#123;<br>    name: <span class="hljs-built_in">String</span>,<br>&#125;<br><br><span class="hljs-keyword">impl</span> Person &#123;<br>    <span class="hljs-comment">// 接受:</span><br>    <span class="hljs-comment">// - String</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">new1</span></span>(name: <span class="hljs-built_in">String</span>) -&gt; Person &#123;<br>        Person &#123; name &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 接受:</span><br>    <span class="hljs-comment">// - String</span><br>    <span class="hljs-comment">// - &amp;String</span><br>    <span class="hljs-comment">// - &amp;str</span><br>    <span class="hljs-comment">// - Box&lt;str&gt;</span><br>    <span class="hljs-comment">// - Cow&lt;&#x27;_, str&gt;</span><br>    <span class="hljs-comment">// - char</span><br>    <span class="hljs-comment">// 因为上面所有的类型都可以转换为 String</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">new2</span></span>&lt;N: <span class="hljs-built_in">Into</span>&lt;<span class="hljs-built_in">String</span>&gt;&gt;(name: N) -&gt; Person &#123;<br>        Person &#123; name: name.into() &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h2 id="七、错误处理"><a href="#七、错误处理" class="headerlink" title="七、错误处理"></a>七、错误处理</h2><h3 id="1-Error-Trait"><a href="#1-Error-Trait" class="headerlink" title="1. Error Trait"></a>1. Error Trait</h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Error</span></span>: <span class="hljs-built_in">Debug</span> + Display &#123;<br>    <span class="hljs-comment">// 提供默认实现</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">source</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">Option</span>&lt;&amp;(<span class="hljs-keyword">dyn</span> Error + <span class="hljs-symbol">&#x27;static</span>)&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">backtrace</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">Option</span>&lt;&amp;Backtrace&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">description</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-built_in">str</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">cause</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">Option</span>&lt;&amp;<span class="hljs-keyword">dyn</span> Error&gt;;<br>&#125; <br></code></pre></td></tr></table></figure>
</li>
<li><p>功能</p>
<ol>
<li>rust中，错误是被return返回的，而不是被throw抛出的</li>
</ol>
</li>
<li><p>一个例子</p>
<ol>
<li><p>安全除法</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::fmt;<br><span class="hljs-keyword">use</span> std::error;<br><br><span class="hljs-meta">#[derive(Debug, PartialEq)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">DivByZero</span></span>;<br><br><span class="hljs-keyword">impl</span> fmt::Display <span class="hljs-keyword">for</span> DivByZero &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">fmt</span></span>(&amp;<span class="hljs-keyword">self</span>, f: &amp;<span class="hljs-keyword">mut</span> fmt::Formatter&lt;<span class="hljs-symbol">&#x27;_</span>&gt;) -&gt; fmt::<span class="hljs-built_in">Result</span> &#123;<br>        <span class="hljs-built_in">write!</span>(f, <span class="hljs-string">&quot;division by zero error&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> error::Error <span class="hljs-keyword">for</span> DivByZero &#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">safe_div</span></span>(numerator: <span class="hljs-built_in">i32</span>, denominator: <span class="hljs-built_in">i32</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-built_in">i32</span>, DivByZero&gt; &#123;<br>    <span class="hljs-keyword">if</span> denominator == <span class="hljs-number">0</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">Err</span>(DivByZero);<br>    &#125;<br>    <span class="hljs-literal">Ok</span>(numerator / denominator)<br>&#125;<br><br><span class="hljs-meta">#[test]</span> <span class="hljs-comment">// ✅</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">test_safe_div</span></span>() &#123;<br>    <span class="hljs-built_in">assert_eq!</span>(safe_div(<span class="hljs-number">8</span>, <span class="hljs-number">2</span>), <span class="hljs-literal">Ok</span>(<span class="hljs-number">4</span>));<br>    <span class="hljs-built_in">assert_eq!</span>(safe_div(<span class="hljs-number">5</span>, <span class="hljs-number">0</span>), <span class="hljs-literal">Err</span>(DivByZero));<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>特点</p>
<ol>
<li><p>错误是被返回而不是被抛出，所以这些错误必须被显式地处理，如果当前函数无法处理错误，该函数应该把错误传递给自己的调用者。</p>
</li>
<li><p>传递错误的最常用方式是使用?操作符，它是现在已经弃用的try!宏的语法糖</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-built_in">macro_rules!</span> <span class="hljs-keyword">try</span> &#123;<br>    ($expr:expr) =&gt; &#123;<br>        <span class="hljs-keyword">match</span> $expr &#123;<br>            <span class="hljs-comment">// if Ok just unwrap the value</span><br>            <span class="hljs-literal">Ok</span>(val) =&gt; val,<br>            <span class="hljs-comment">// if Err map the err value using From and return</span><br>            <span class="hljs-literal">Err</span>(err) =&gt; &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">Err</span>(<span class="hljs-built_in">From</span>::from(err));<br>            &#125;<br>        &#125;<br>    &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>一个返回io::Error的例子</p>
<ol>
<li><p>这个例子中，所有可能的error都是io::Error类型的</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::io::Read;<br><span class="hljs-keyword">use</span> std::path::Path;<br><span class="hljs-keyword">use</span> std::io;<br><span class="hljs-keyword">use</span> std::fs::File;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">read_file_to_string</span></span>(path: &amp;Path) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-built_in">String</span>, io::Error&gt; &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> file = File::open(path)?; <span class="hljs-comment">// ⬆️ io::Error</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> contents = <span class="hljs-built_in">String</span>::new();<br>    file.read_to_string(&amp;<span class="hljs-keyword">mut</span> contents)?; <span class="hljs-comment">// ⬆️ io::Error</span><br>    <span class="hljs-literal">Ok</span>(contents)<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>如何返回不同种类的Error</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::io::Read;<br><span class="hljs-keyword">use</span> std::path::Path;<br><span class="hljs-keyword">use</span> std::io;<br><span class="hljs-keyword">use</span> std::fs::File;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">sum_file</span></span>(path: &amp;Path) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-built_in">i32</span>, <span class="hljs-comment">/*这里放置什么? */</span>&gt; &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> file = File::open(path)?; <span class="hljs-comment">// ⬆️ io::Error</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> contents = <span class="hljs-built_in">String</span>::new();<br>    file.read_to_string(&amp;<span class="hljs-keyword">mut</span> contents)?; <span class="hljs-comment">// ⬆️ io::Error</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> sum = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> contents.lines() &#123;<br>        sum += line.parse::&lt;<span class="hljs-built_in">i32</span>&gt;()?; <span class="hljs-comment">// ⬆️ ParseIntError</span><br>    &#125;<br>    <span class="hljs-literal">Ok</span>(sum)<br>&#125;<br></code></pre></td></tr></table></figure>
<ol>
<li><p>一种方法是，使用dyn error::Error 接受任意类型Error</p>
<ol>
<li><p>任何一种error类型均可以转换为Box<dyn error::Error> 类型</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">impl</span>&lt;E: error::Error&gt; <span class="hljs-built_in">From</span>&lt;E&gt; <span class="hljs-keyword">for</span> <span class="hljs-built_in">Box</span>&lt;<span class="hljs-keyword">dyn</span> error::Error&gt;;<br></code></pre></td></tr></table></figure>
</li>
<li><p>所以，任意一种Error均可以通过Box<dyn error::Error> 返回给调用者</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::fs::File;<br><span class="hljs-keyword">use</span> std::io::Read;<br><span class="hljs-keyword">use</span> std::path::Path;<br><span class="hljs-keyword">use</span> std::error;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">sum_file</span></span>(path: &amp;Path) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-built_in">i32</span>, <span class="hljs-built_in">Box</span>&lt;<span class="hljs-keyword">dyn</span> error::Error&gt;&gt; &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> file = File::open(path)?; <span class="hljs-comment">// ⬆️ io::Error -&gt; Box&lt;dyn error::Error&gt;</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> contents = <span class="hljs-built_in">String</span>::new();<br>    file.read_to_string(&amp;<span class="hljs-keyword">mut</span> contents)?; <span class="hljs-comment">// ⬆️ io::Error -&gt; Box&lt;dyn error::Error&gt;</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> sum = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> contents.lines() &#123;<br>        sum += line.parse::&lt;<span class="hljs-built_in">i32</span>&gt;()?; <span class="hljs-comment">// ⬆️ ParseIntError -&gt; Box&lt;dyn error::Error&gt;</span><br>    &#125;<br>    <span class="hljs-literal">Ok</span>(sum)<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>如果调用者想知道返回错误的具体类型，需要使用downcast_ref()</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">handle_sum_file_errors</span></span>(path: &amp;Path) &#123;<br>    <span class="hljs-keyword">match</span> sum_file(path) &#123;<br>        <span class="hljs-literal">Ok</span>(sum) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;the sum is &#123;&#125;&quot;</span>, sum),<br>        <span class="hljs-literal">Err</span>(err) =&gt; &#123;<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Some</span>(e) = err.downcast_ref::&lt;io::Error&gt;() &#123;<br>                <span class="hljs-comment">// 处理 io::Error</span><br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-literal">Some</span>(e) = err.downcast_ref::&lt;ParseIntError&gt;() &#123;<br>                <span class="hljs-comment">// 处理 ParseIntError</span><br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// 我们知道 sum_file 只会返回上面错误中的其中一个</span><br>                <span class="hljs-comment">// 所以不会到达这个分支</span><br>                <span class="hljs-built_in">unreachable!</span>();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>第二种方法是：使用Enum类型枚举所有可能的error</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::num::ParseIntError;<br><span class="hljs-keyword">use</span> std::fs::File;<br><span class="hljs-keyword">use</span> std::io;<br><span class="hljs-keyword">use</span> std::io::Read;<br><span class="hljs-keyword">use</span> std::path::Path;<br><span class="hljs-keyword">use</span> std::error;<br><span class="hljs-keyword">use</span> std::fmt;<br><br><span class="hljs-meta">#[derive(Debug)]</span><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SumFileError</span></span> &#123;<br>    Io(io::Error),<br>    Parse(ParseIntError),<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">From</span>&lt;io::Error&gt; <span class="hljs-keyword">for</span> SumFileError &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">from</span></span>(err: io::Error) -&gt; <span class="hljs-keyword">Self</span> &#123;<br>        SumFileError::Io(err)<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">From</span>&lt;ParseIntError&gt; <span class="hljs-keyword">for</span> SumFileError &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">from</span></span>(err: ParseIntError) -&gt; <span class="hljs-keyword">Self</span> &#123;<br>        SumFileError::Parse(err)<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> fmt::Display <span class="hljs-keyword">for</span> SumFileError &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">fmt</span></span>(&amp;<span class="hljs-keyword">self</span>, f: &amp;<span class="hljs-keyword">mut</span> fmt::Formatter&lt;<span class="hljs-symbol">&#x27;_</span>&gt;) -&gt; fmt::<span class="hljs-built_in">Result</span> &#123;<br>        <span class="hljs-keyword">match</span> <span class="hljs-keyword">self</span> &#123;<br>            SumFileError::Io(err) =&gt; <span class="hljs-built_in">write!</span>(f, <span class="hljs-string">&quot;sum file error: &#123;&#125;&quot;</span>, err),<br>            SumFileError::Parse(err) =&gt; <span class="hljs-built_in">write!</span>(f, <span class="hljs-string">&quot;sum file error: &#123;&#125;&quot;</span>, err),<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> error::Error <span class="hljs-keyword">for</span> SumFileError &#123;<br>    <span class="hljs-comment">// 这个方法的默认实现总是返回 None</span><br>    <span class="hljs-comment">//但是我们现在重写它，让它更有用    </span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">source</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">Option</span>&lt;&amp;(<span class="hljs-keyword">dyn</span> error::Error + <span class="hljs-symbol">&#x27;static</span>)&gt; &#123;<br>        <span class="hljs-literal">Some</span>(<span class="hljs-keyword">match</span> <span class="hljs-keyword">self</span> &#123;<br>            SumFileError::Io(err) =&gt; err,<br>            SumFileError::Parse(err) =&gt; err,<br>        &#125;)<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">sum_file</span></span>(path: &amp;Path) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-built_in">i32</span>, SumFileError&gt; &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> file = File::open(path)?; <span class="hljs-comment">// ⬆️ io::Error -&gt; SumFileError</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> contents = <span class="hljs-built_in">String</span>::new();<br>    file.read_to_string(&amp;<span class="hljs-keyword">mut</span> contents)?; <span class="hljs-comment">// ⬆️ io::Error -&gt; SumFileError</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> sum = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> contents.lines() &#123;<br>        sum += line.parse::&lt;<span class="hljs-built_in">i32</span>&gt;()?; <span class="hljs-comment">// ⬆️ ParseIntError -&gt; SumFileError</span><br>    &#125;<br>    <span class="hljs-literal">Ok</span>(sum)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">handle_sum_file_errors</span></span>(path: &amp;Path) &#123;<br>    <span class="hljs-keyword">match</span> sum_file(path) &#123;<br>        <span class="hljs-literal">Ok</span>(sum) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;the sum is &#123;&#125;&quot;</span>, sum),<br>        <span class="hljs-literal">Err</span>(SumFileError::Io(err)) =&gt; &#123;<br>            <span class="hljs-comment">// 处理 io::Error</span><br>        &#125;,<br>        <span class="hljs-literal">Err</span>(SumFileError::Parse(err)) =&gt; &#123;<br>            <span class="hljs-comment">// 处理 ParseIntError</span><br>        &#125;,<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="六、转换类型（续）"><a href="#六、转换类型（续）" class="headerlink" title="六、转换类型（续）"></a>六、转换类型（续）</h2><h3 id="1-TryFrom-amp-TryInto"><a href="#1-TryFrom-amp-TryInto" class="headerlink" title="1. TryFrom &amp; TryInto"></a>1. TryFrom &amp; TryInto</h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">TryFrom</span></span>&lt;T&gt; &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Error</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">try_from</span></span>(value: T) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-keyword">Self</span>, Self::Error&gt;;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">TryInto</span></span>&lt;T&gt; &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Error</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">try_into</span></span>(<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;T, Self::Error&gt;;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>功能：允许失败版本的From&#x2F;Into</p>
</li>
<li><p>一个例子</p>
<ol>
<li><p>Point中的x和y如果值小于-1000或者大于1000没有意义，则可以如下实现转换函数</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::convert::TryFrom;<br><span class="hljs-keyword">use</span> std::error;<br><span class="hljs-keyword">use</span> std::fmt;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span>,<br>&#125;<br><br><span class="hljs-meta">#[derive(Debug)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">OutOfBounds</span></span>;<br><br><span class="hljs-keyword">impl</span> fmt::Display <span class="hljs-keyword">for</span> OutOfBounds &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">fmt</span></span>(&amp;<span class="hljs-keyword">self</span>, f: &amp;<span class="hljs-keyword">mut</span> fmt::Formatter&lt;<span class="hljs-symbol">&#x27;_</span>&gt;) -&gt; fmt::<span class="hljs-built_in">Result</span> &#123;<br>        <span class="hljs-built_in">write!</span>(f, <span class="hljs-string">&quot;out of bounds&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> error::Error <span class="hljs-keyword">for</span> OutOfBounds &#123;&#125;<br><br><span class="hljs-comment">// 现在是可以出错的</span><br><span class="hljs-keyword">impl</span> TryFrom&lt;(<span class="hljs-built_in">i32</span>, <span class="hljs-built_in">i32</span>)&gt; <span class="hljs-keyword">for</span> Point &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Error</span></span> = OutOfBounds;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">try_from</span></span>((x, y): (<span class="hljs-built_in">i32</span>, <span class="hljs-built_in">i32</span>)) -&gt; <span class="hljs-built_in">Result</span>&lt;Point, OutOfBounds&gt; &#123;<br>        <span class="hljs-keyword">if</span> x.abs() &gt; <span class="hljs-number">1000</span> || y.abs() &gt; <span class="hljs-number">1000</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">Err</span>(OutOfBounds);<br>        &#125;<br>        <span class="hljs-literal">Ok</span>(Point &#123; x, y &#125;)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 仍然是不会出错的</span><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">From</span>&lt;Point&gt; <span class="hljs-keyword">for</span> (<span class="hljs-built_in">i32</span>, <span class="hljs-built_in">i32</span>) &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">from</span></span>(Point &#123; x, y &#125;: Point) -&gt; <span class="hljs-keyword">Self</span> &#123;<br>        (x, y)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h3 id="2-FromStr"><a href="#2-FromStr" class="headerlink" title="2. FromStr"></a>2. FromStr</h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">FromStr</span></span> &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Err</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">from_str</span></span>(s: &amp;<span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-keyword">Self</span>, Self::<span class="hljs-literal">Err</span>&gt;;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>功能</p>
<p> FromStr 类型允许执行一个从&amp;str到Self的可失败的转换。最常见的使用是在&amp;str上调用.parse()方法。</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::<span class="hljs-built_in">str</span>::FromStr;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">example</span></span>&lt;T: FromStr&gt;(s: &amp;<span class="hljs-symbol">&#x27;static</span> <span class="hljs-built_in">str</span>) &#123;<br>    <span class="hljs-comment">// 这些都是相等的</span><br>    <span class="hljs-keyword">let</span> t: <span class="hljs-built_in">Result</span>&lt;T, _&gt; = FromStr::from_str(s);<br>    <span class="hljs-keyword">let</span> t = T::from_str(s);<br>    <span class="hljs-keyword">let</span> t: <span class="hljs-built_in">Result</span>&lt;T, _&gt; = s.parse();<br>    <span class="hljs-keyword">let</span> t = s.parse::&lt;T&gt;(); <span class="hljs-comment">// 最常见的</span><br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>一个例子</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::error;<br><span class="hljs-keyword">use</span> std::fmt;<br><span class="hljs-keyword">use</span> std::iter::Enumerate;<br><span class="hljs-keyword">use</span> std::num::ParseIntError;<br><span class="hljs-keyword">use</span> std::<span class="hljs-built_in">str</span>::&#123;Chars, FromStr&#125;;<br><br><span class="hljs-meta">#[derive(Debug, Eq, PartialEq)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span></span> &#123;<br>    x: <span class="hljs-built_in">i32</span>,<br>    y: <span class="hljs-built_in">i32</span>,<br>&#125;<br><br><span class="hljs-keyword">impl</span> Point &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">new</span></span>(x: <span class="hljs-built_in">i32</span>, y: <span class="hljs-built_in">i32</span>) -&gt; <span class="hljs-keyword">Self</span> &#123;<br>        Point &#123; x, y &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">#[derive(Debug, PartialEq)]</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ParsePointError</span></span>;<br><br><span class="hljs-keyword">impl</span> fmt::Display <span class="hljs-keyword">for</span> ParsePointError &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">fmt</span></span>(&amp;<span class="hljs-keyword">self</span>, f: &amp;<span class="hljs-keyword">mut</span> fmt::Formatter&lt;<span class="hljs-symbol">&#x27;_</span>&gt;) -&gt; fmt::<span class="hljs-built_in">Result</span> &#123;<br>        <span class="hljs-built_in">write!</span>(f, <span class="hljs-string">&quot;failed to parse point&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">From</span>&lt;ParseIntError&gt; <span class="hljs-keyword">for</span> ParsePointError &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">from</span></span>(_e: ParseIntError) -&gt; <span class="hljs-keyword">Self</span> &#123;<br>        ParsePointError<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> error::Error <span class="hljs-keyword">for</span> ParsePointError &#123;&#125;<br><br><span class="hljs-keyword">impl</span> FromStr <span class="hljs-keyword">for</span> Point &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Err</span></span> = ParsePointError;<br><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">from_str</span></span>(s: &amp;<span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-keyword">Self</span>, Self::<span class="hljs-literal">Err</span>&gt; &#123;<br>        <span class="hljs-keyword">let</span> is_num = |(_, c): &amp;(<span class="hljs-built_in">usize</span>, <span class="hljs-built_in">char</span>)| matches!(c, <span class="hljs-string">&#x27;0&#x27;</span>..=<span class="hljs-string">&#x27;9&#x27;</span> | <span class="hljs-string">&#x27;-&#x27;</span>);<br>        <span class="hljs-keyword">let</span> isnt_num = |t: &amp;(_, _)| !is_num(t);<br><br>        <span class="hljs-keyword">let</span> get_num =<br>            |char_idxs: &amp;<span class="hljs-keyword">mut</span> Enumerate&lt;Chars&lt;<span class="hljs-symbol">&#x27;_</span>&gt;&gt;| -&gt; <span class="hljs-built_in">Result</span>&lt;(<span class="hljs-built_in">usize</span>, <span class="hljs-built_in">usize</span>), ParsePointError&gt; &#123;<br>                <span class="hljs-keyword">let</span> (start, _) = char_idxs<br>                    .skip_while(isnt_num)<br>                    .next()<br>                    .ok_or(ParsePointError)?;<br>                <span class="hljs-keyword">let</span> (end, _) = char_idxs<br>                    .skip_while(is_num)<br>                    .next()<br>                    .ok_or(ParsePointError)?;<br>                <span class="hljs-literal">Ok</span>((start, end))<br>            &#125;;<br><br>        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> char_idxs = s.chars().enumerate();<br>        <span class="hljs-keyword">let</span> (x_start, x_end) = get_num(&amp;<span class="hljs-keyword">mut</span> char_idxs)?;<br>        <span class="hljs-keyword">let</span> (y_start, y_end) = get_num(&amp;<span class="hljs-keyword">mut</span> char_idxs)?;<br><br>        <span class="hljs-keyword">let</span> x = s[x_start..x_end].parse::&lt;<span class="hljs-built_in">i32</span>&gt;()?;<br>        <span class="hljs-keyword">let</span> y = s[y_start..y_end].parse::&lt;<span class="hljs-built_in">i32</span>&gt;()?;<br><br>        <span class="hljs-literal">Ok</span>(Point &#123; x, y &#125;)<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">#[test]</span> <span class="hljs-comment">// ✅</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">pos_x_y</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> p = <span class="hljs-string">&quot;(4, 5)&quot;</span>.parse::&lt;Point&gt;();<br>    <span class="hljs-built_in">assert_eq!</span>(p, <span class="hljs-literal">Ok</span>(Point::new(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>)));<br>&#125;<br><br><span class="hljs-meta">#[test]</span> <span class="hljs-comment">// ✅</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">neg_x_y</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> p = <span class="hljs-string">&quot;(-6, -2)&quot;</span>.parse::&lt;Point&gt;();<br>    <span class="hljs-built_in">assert_eq!</span>(p, <span class="hljs-literal">Ok</span>(Point::new(-<span class="hljs-number">6</span>, -<span class="hljs-number">2</span>)));<br>&#125;<br><br><span class="hljs-meta">#[test]</span> <span class="hljs-comment">// ✅</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">not_a_point</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> p = <span class="hljs-string">&quot;not a point&quot;</span>.parse::&lt;Point&gt;();<br>    <span class="hljs-built_in">assert_eq!</span>(p, <span class="hljs-literal">Err</span>(ParsePointError));<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>特点</p>
<ol>
<li><p>FromStr和TryFrom&lt;&amp;str&gt;有着相同的签名。只要我们通过其中一个实现另一个，先实现哪个并不重要。</p>
<ol>
<li>一个例子</li>
</ol>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">impl</span> TryFrom&lt;&amp;<span class="hljs-built_in">str</span>&gt; <span class="hljs-keyword">for</span> Point &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Error</span></span> = &lt;Point <span class="hljs-keyword">as</span> FromStr&gt;::<span class="hljs-literal">Err</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">try_from</span></span>(s: &amp;<span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;Point, Self::Error&gt; &#123;<br>        &lt;Point <span class="hljs-keyword">as</span> FromStr&gt;::from_str(s)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h3 id="2-AsRef-amp-AsMut"><a href="#2-AsRef-amp-AsMut" class="headerlink" title="2. AsRef &amp; AsMut"></a>2. <strong><strong>AsRef &amp; AsMut</strong></strong></h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">AsRef</span></span>&lt;T: ?<span class="hljs-built_in">Sized</span>&gt; &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">as_ref</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;T;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">AsMut</span></span>&lt;T: ?<span class="hljs-built_in">Sized</span>&gt; &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">as_mut</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-keyword">mut</span> T;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>作用：</p>
<ol>
<li><p>总的来说，AsRef被用于轻量级的引用到引用之间的转换。下面举几个实际的例子</p>
</li>
<li><p>AsRef trait可以使函数在是否获取所有权上具有通用性：</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// accepts:</span><br><span class="hljs-comment">//  - &amp;str</span><br><span class="hljs-comment">//  - &amp;String</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">takes_str</span></span>(s: &amp;<span class="hljs-built_in">str</span>) &#123;<br>    <span class="hljs-comment">// use &amp;str</span><br>&#125;<br><br><span class="hljs-comment">// accepts:</span><br><span class="hljs-comment">//  - &amp;str</span><br><span class="hljs-comment">//  - &amp;String</span><br><span class="hljs-comment">//  - String</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">takes_asref_str</span></span>&lt;S: <span class="hljs-built_in">AsRef</span>&lt;<span class="hljs-built_in">str</span>&gt;&gt;(s: S) &#123;<br>    <span class="hljs-keyword">let</span> s: &amp;<span class="hljs-built_in">str</span> = s.as_ref();<br>    <span class="hljs-comment">// use &amp;str</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">example</span></span>(slice: &amp;<span class="hljs-built_in">str</span>, borrow: &amp;<span class="hljs-built_in">String</span>, owned: <span class="hljs-built_in">String</span>) &#123;<br>    takes_str(slice);<br>    takes_str(borrow);<br>    takes_str(owned); <span class="hljs-comment">// ❌</span><br>    takes_asref_str(slice);<br>    takes_asref_str(borrow);<br>    takes_asref_str(owned); <span class="hljs-comment">// ✅</span><br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>AsRef 可以返回类型内部私有数据的引用。通常这个私有数据被一个不可变类型所包裹</p>
<p> 例如标准库的String, 包裹了Vec<u8> 作为私有数据。内部的Vec<u8>不能被公开，因为如果这样的话，人们就会修改里面的字节并破坏String中有效的 UTF-8 编码。但是，暴露内部字节数组的一个不可变的只读引用是安全的，</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">String</span></span> &#123;<br>    vec: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">u8</span>&gt;,<br>&#125;<br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">AsRef</span>&lt;[<span class="hljs-built_in">u8</span>]&gt; <span class="hljs-keyword">for</span> <span class="hljs-built_in">String</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>AsRef用于语义相等的事物之间引用到引用的转换，</p>
<ol>
<li><p>一个反例</p>
<p> 下面是为任意类型实现AsRef</p>
<p> User 包含String&#x2F;u32， 但User不是String&#x2F;u32。对于这样的类型实现AsRef没有什么意义，</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">User</span></span> &#123;<br>    name: <span class="hljs-built_in">String</span>,<br>    email: <span class="hljs-built_in">String</span>,<br>    age: <span class="hljs-built_in">u32</span>,<br>    height: <span class="hljs-built_in">u32</span>,<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">AsRef</span>&lt;<span class="hljs-built_in">String</span>&gt; <span class="hljs-keyword">for</span> User &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">as_ref</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-built_in">String</span> &#123;、<br>        <span class="hljs-comment">//我们返回 name 还是 email?        </span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">AsRef</span>&lt;<span class="hljs-built_in">u32</span>&gt; <span class="hljs-keyword">for</span> User &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">as_ref</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-built_in">u32</span> &#123;<br>        <span class="hljs-comment">//我们返回 age 还是 height？</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>一个正确的例子</p>
<p> Moderator 是一个User，User可以做的事情，Moderator也应该可以做</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">User</span></span> &#123;<br>    name: <span class="hljs-built_in">String</span>,<br>    age: <span class="hljs-built_in">u32</span>,<br>&#125;<br><br><span class="hljs-comment">//不幸地是，标准库并没有提供一个generic blanket impl来避免这种重复的实现</span><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">AsRef</span>&lt;User&gt; <span class="hljs-keyword">for</span> User &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">as_ref</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;User &#123;<br>        <span class="hljs-keyword">self</span><br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Privilege</span></span> &#123;<br>    BanUsers,<br>    EditPosts,<br>    DeletePosts,<br>&#125;<br><br><span class="hljs-comment">//尽管 Moderators 有一些特殊权限，它们仍然是普通的 User </span><br><span class="hljs-comment">//并且应该做相同的事情</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Moderator</span></span> &#123;<br>    user: User,<br>    privileges: <span class="hljs-built_in">Vec</span>&lt;Privilege&gt;<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">AsRef</span>&lt;Moderator&gt; <span class="hljs-keyword">for</span> Moderator &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">as_ref</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;Moderator &#123;<br>        <span class="hljs-keyword">self</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">impl</span> <span class="hljs-built_in">AsRef</span>&lt;User&gt; <span class="hljs-keyword">for</span> Moderator &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">as_ref</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;User &#123;<br>        &amp;<span class="hljs-keyword">self</span>.user<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//使用 User 和 Moderators （也是一种User）应该都是可以调用的</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">create_post</span></span>&lt;U: <span class="hljs-built_in">AsRef</span>&lt;User&gt;&gt;(u: U) &#123;<br>    <span class="hljs-keyword">let</span> user = u.as_ref();<br>    <span class="hljs-comment">// etc</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">example</span></span>(user: User, moderator: Moderator) &#123;<br>    create_post(&amp;user);<br>    create_post(&amp;moderator); <span class="hljs-comment">// ✅</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="3-Borrow-x2F-BorrowMut"><a href="#3-Borrow-x2F-BorrowMut" class="headerlink" title="3. Borrow&#x2F;BorrowMut"></a>3. Borrow&#x2F;BorrowMut</h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Borrow</span></span>&lt;Borrowed&gt;<br><span class="hljs-keyword">where</span><br>    Borrowed: ?<span class="hljs-built_in">Sized</span>,<br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">borrow</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; &amp;Borrowed;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">BorrowMut</span></span>&lt;Borrowed&gt;: Borrow&lt;Borrowed&gt;<br><span class="hljs-keyword">where</span><br>    Borrowed: ?<span class="hljs-built_in">Sized</span>,<br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">borrow_mut</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-keyword">mut</span> Borrowed;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>作用</p>
<ol>
<li>最初的作用：使用&amp;str类型的值在HashSet、HashMap、BTreeSet和BTreeMap中查找String类型的 key。</li>
<li>我们可以把Borrow<T>和BorrowMut<T>看作更严格的AsRef<T>和AsMut<T>，它们返回的引用&amp;T与Self有等价性的Eq、Hash和Ord实现。</li>
</ol>
</li>
<li><p>例子</p>
<p> borrow&#x2F;borrow_mut 返回的引用 是满足Eq、Hash、Ord三个Trait的</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::borrow::Borrow;<br><span class="hljs-keyword">use</span> std::hash::Hasher;<br><span class="hljs-keyword">use</span> std::collections::hash_map::DefaultHasher;<br><span class="hljs-keyword">use</span> std::hash::Hash;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">get_hash</span></span>&lt;T: Hash&gt;(t: T) -&gt; <span class="hljs-built_in">u64</span> &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> hasher = DefaultHasher::new();<br>    t.hash(&amp;<span class="hljs-keyword">mut</span> hasher);<br>    hasher.finish()<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">asref_example</span></span>&lt;Owned, Ref&gt;(owned1: Owned, owned2: Owned)<br><span class="hljs-keyword">where</span><br>    Owned: <span class="hljs-built_in">Eq</span> + <span class="hljs-built_in">Ord</span> + Hash + <span class="hljs-built_in">AsRef</span>&lt;Ref&gt;,<br>    Ref: <span class="hljs-built_in">Eq</span> + <span class="hljs-built_in">Ord</span> + Hash<br>&#123;<br>    <span class="hljs-keyword">let</span> ref1: &amp;Ref = owned1.as_ref();<br>    <span class="hljs-keyword">let</span> ref2: &amp;Ref = owned2.as_ref();<br><br>    <span class="hljs-comment">// refs aren&#x27;t required to be equal if owned types are equal</span><br>    <span class="hljs-built_in">assert_eq!</span>(owned1 == owned2, ref1 == ref2); <span class="hljs-comment">// ❌</span><br><br>    <span class="hljs-keyword">let</span> owned1_hash = get_hash(&amp;owned1);<br>    <span class="hljs-keyword">let</span> owned2_hash = get_hash(&amp;owned2);<br>    <span class="hljs-keyword">let</span> ref1_hash = get_hash(&amp;ref1);<br>    <span class="hljs-keyword">let</span> ref2_hash = get_hash(&amp;ref2);<br><br>    <span class="hljs-comment">// ref hashes aren&#x27;t required to be equal if owned type hashes are equal</span><br>    <span class="hljs-built_in">assert_eq!</span>(owned1_hash == owned2_hash, ref1_hash == ref2_hash); <span class="hljs-comment">// ❌</span><br><br>    <span class="hljs-comment">// ref comparisons aren&#x27;t required to match owned type comparisons</span><br>    <span class="hljs-built_in">assert_eq!</span>(owned1.cmp(&amp;owned2), ref1.cmp(&amp;ref2)); <span class="hljs-comment">// ❌</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">borrow_example</span></span>&lt;Owned, Borrowed&gt;(owned1: Owned, owned2: Owned)<br><span class="hljs-keyword">where</span><br>    Owned: <span class="hljs-built_in">Eq</span> + <span class="hljs-built_in">Ord</span> + Hash + Borrow&lt;Borrowed&gt;,<br>    Borrowed: <span class="hljs-built_in">Eq</span> + <span class="hljs-built_in">Ord</span> + Hash<br>&#123;<br>    <span class="hljs-keyword">let</span> borrow1: &amp;Borrowed = owned1.borrow();<br>    <span class="hljs-keyword">let</span> borrow2: &amp;Borrowed = owned2.borrow();<br><br>    <span class="hljs-comment">// borrows are required to be equal if owned types are equal</span><br>    <span class="hljs-built_in">assert_eq!</span>(owned1 == owned2, borrow1 == borrow2); <span class="hljs-comment">// ✅</span><br><br>    <span class="hljs-keyword">let</span> owned1_hash = get_hash(&amp;owned1);<br>    <span class="hljs-keyword">let</span> owned2_hash = get_hash(&amp;owned2);<br>    <span class="hljs-keyword">let</span> borrow1_hash = get_hash(&amp;borrow1);<br>    <span class="hljs-keyword">let</span> borrow2_hash = get_hash(&amp;borrow2);<br><br>    <span class="hljs-comment">// borrow hashes are required to be equal if owned type hashes are equal</span><br>    <span class="hljs-built_in">assert_eq!</span>(owned1_hash == owned2_hash, borrow1_hash == borrow2_hash); <span class="hljs-comment">// ✅</span><br><br>    <span class="hljs-comment">// borrow comparisons are required to match owned type comparisons</span><br>    <span class="hljs-built_in">assert_eq!</span>(owned1.cmp(&amp;owned2), borrow1.cmp(&amp;borrow2)); <span class="hljs-comment">// ✅</span><br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>特点</p>
<ol>
<li>这个Trait是为一个类型的引用类型准备的，很少由程序员手动实现引用类型的Trait</li>
<li><code>T:Borrorw&lt;T&gt;</code>已经为所有的类型T实现了，所以我们不需要手动地实现它；并且我们不需要创建一个U以用来<code>T:Borrow&lt;U&gt;</code></li>
</ol>
</li>
</ol>
<h3 id="4-ToOwned"><a href="#4-ToOwned" class="headerlink" title="4. ToOwned"></a>4. ToOwned</h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">ToOwned</span></span> &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Owned</span></span>: Borrow&lt;<span class="hljs-keyword">Self</span>&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">to_owned</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; Self::Owned;<br><br>    <span class="hljs-comment">// 提供默认实现</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">clone_into</span></span>(&amp;<span class="hljs-keyword">self</span>, target: &amp;<span class="hljs-keyword">mut</span> Self::Owned);<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>作用</p>
<ol>
<li>ToOwned是Clone的一个更为通用的版本。Clone允许我们获取一个&amp;T并把它转为一个T，但是ToOwned允许我们拿到一个&amp;Borrowed并把它转为一个Owned，其中Owned: Borrow<Borrowed>。<ol>
<li>换句话说，我们不能从一个&amp;str克隆一个String，或者从一个&amp;Path克隆一个PathBuf，或者从一个&amp;OsStr克隆一个OsString，因为clone方法签名不支持这种跨类型的克隆，这就是ToOwned产生的原因。</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="八、Iteration-Traits"><a href="#八、Iteration-Traits" class="headerlink" title="八、Iteration Traits"></a>八、<strong><strong>Iteration Traits</strong></strong></h2><h3 id="1-Iterator"><a href="#1-Iterator" class="headerlink" title="1. Iterator"></a>1. Iterator</h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Iterator</span></span> &#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Item</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">next</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">Option</span>&lt;Self::Item&gt;;<br><br>    <span class="hljs-comment">// provided default impls</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">size_hint</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; (<span class="hljs-built_in">usize</span>, <span class="hljs-built_in">Option</span>&lt;<span class="hljs-built_in">usize</span>&gt;);<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">count</span></span>(<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">usize</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">last</span></span>(<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">Option</span>&lt;Self::Item&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">advance_by</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, n: <span class="hljs-built_in">usize</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;(), <span class="hljs-built_in">usize</span>&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">nth</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, n: <span class="hljs-built_in">usize</span>) -&gt; <span class="hljs-built_in">Option</span>&lt;Self::Item&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">step_by</span></span>(<span class="hljs-keyword">self</span>, step: <span class="hljs-built_in">usize</span>) -&gt; StepBy&lt;<span class="hljs-keyword">Self</span>&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">chain</span></span>&lt;U&gt;(<br>        <span class="hljs-keyword">self</span>, <br>        other: U<br>    ) -&gt; Chain&lt;<span class="hljs-keyword">Self</span>, &lt;U <span class="hljs-keyword">as</span> <span class="hljs-built_in">IntoIterator</span>&gt;::IntoIter&gt;<br>    <span class="hljs-keyword">where</span><br>        U: <span class="hljs-built_in">IntoIterator</span>&lt;Item = Self::Item&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">zip</span></span>&lt;U&gt;(<span class="hljs-keyword">self</span>, other: U) -&gt; Zip&lt;<span class="hljs-keyword">Self</span>, &lt;U <span class="hljs-keyword">as</span> <span class="hljs-built_in">IntoIterator</span>&gt;::IntoIter&gt;<br>    <span class="hljs-keyword">where</span><br>        U: <span class="hljs-built_in">IntoIterator</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">map</span></span>&lt;B, F&gt;(<span class="hljs-keyword">self</span>, f: F) -&gt; Map&lt;<span class="hljs-keyword">Self</span>, F&gt;<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(Self::Item) -&gt; B;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">for_each</span></span>&lt;F&gt;(<span class="hljs-keyword">self</span>, f: F)<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(Self::Item);<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">filter</span></span>&lt;P&gt;(<span class="hljs-keyword">self</span>, predicate: P) -&gt; Filter&lt;<span class="hljs-keyword">Self</span>, P&gt;<br>    <span class="hljs-keyword">where</span><br>        P: <span class="hljs-built_in">FnMut</span>(&amp;Self::Item) -&gt; <span class="hljs-built_in">bool</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">filter_map</span></span>&lt;B, F&gt;(<span class="hljs-keyword">self</span>, f: F) -&gt; FilterMap&lt;<span class="hljs-keyword">Self</span>, F&gt;<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(Self::Item) -&gt; <span class="hljs-built_in">Option</span>&lt;B&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">enumerate</span></span>(<span class="hljs-keyword">self</span>) -&gt; Enumerate&lt;<span class="hljs-keyword">Self</span>&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">peekable</span></span>(<span class="hljs-keyword">self</span>) -&gt; Peekable&lt;<span class="hljs-keyword">Self</span>&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">skip_while</span></span>&lt;P&gt;(<span class="hljs-keyword">self</span>, predicate: P) -&gt; SkipWhile&lt;<span class="hljs-keyword">Self</span>, P&gt;<br>    <span class="hljs-keyword">where</span><br>        P: <span class="hljs-built_in">FnMut</span>(&amp;Self::Item) -&gt; <span class="hljs-built_in">bool</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">take_while</span></span>&lt;P&gt;(<span class="hljs-keyword">self</span>, predicate: P) -&gt; TakeWhile&lt;<span class="hljs-keyword">Self</span>, P&gt;<br>    <span class="hljs-keyword">where</span><br>        P: <span class="hljs-built_in">FnMut</span>(&amp;Self::Item) -&gt; <span class="hljs-built_in">bool</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">map_while</span></span>&lt;B, P&gt;(<span class="hljs-keyword">self</span>, predicate: P) -&gt; MapWhile&lt;<span class="hljs-keyword">Self</span>, P&gt;<br>    <span class="hljs-keyword">where</span><br>        P: <span class="hljs-built_in">FnMut</span>(Self::Item) -&gt; <span class="hljs-built_in">Option</span>&lt;B&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">skip</span></span>(<span class="hljs-keyword">self</span>, n: <span class="hljs-built_in">usize</span>) -&gt; Skip&lt;<span class="hljs-keyword">Self</span>&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">take</span></span>(<span class="hljs-keyword">self</span>, n: <span class="hljs-built_in">usize</span>) -&gt; Take&lt;<span class="hljs-keyword">Self</span>&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">scan</span></span>&lt;St, B, F&gt;(<span class="hljs-keyword">self</span>, initial_state: St, f: F) -&gt; Scan&lt;<span class="hljs-keyword">Self</span>, St, F&gt;<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(&amp;<span class="hljs-keyword">mut</span> St, Self::Item) -&gt; <span class="hljs-built_in">Option</span>&lt;B&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">flat_map</span></span>&lt;U, F&gt;(<span class="hljs-keyword">self</span>, f: F) -&gt; FlatMap&lt;<span class="hljs-keyword">Self</span>, U, F&gt;<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(Self::Item) -&gt; U,<br>        U: <span class="hljs-built_in">IntoIterator</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">flatten</span></span>(<span class="hljs-keyword">self</span>) -&gt; Flatten&lt;<span class="hljs-keyword">Self</span>&gt;<br>    <span class="hljs-keyword">where</span><br>        Self::Item: <span class="hljs-built_in">IntoIterator</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">fuse</span></span>(<span class="hljs-keyword">self</span>) -&gt; Fuse&lt;<span class="hljs-keyword">Self</span>&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">inspect</span></span>&lt;F&gt;(<span class="hljs-keyword">self</span>, f: F) -&gt; Inspect&lt;<span class="hljs-keyword">Self</span>, F&gt;<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(&amp;Self::Item);<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">by_ref</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">Self</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">collect</span></span>&lt;B&gt;(<span class="hljs-keyword">self</span>) -&gt; B<br>    <span class="hljs-keyword">where</span><br>        B: FromIterator&lt;Self::Item&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">partition</span></span>&lt;B, F&gt;(<span class="hljs-keyword">self</span>, f: F) -&gt; (B, B)<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(&amp;Self::Item) -&gt; <span class="hljs-built_in">bool</span>,<br>        B: <span class="hljs-built_in">Default</span> + <span class="hljs-built_in">Extend</span>&lt;Self::Item&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">partition_in_place</span></span>&lt;<span class="hljs-symbol">&#x27;a</span>, T, P&gt;(<span class="hljs-keyword">self</span>, predicate: P) -&gt; <span class="hljs-built_in">usize</span><br>    <span class="hljs-keyword">where</span><br>        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">DoubleEndedIterator</span>&lt;Item = &amp;<span class="hljs-symbol">&#x27;a</span> <span class="hljs-keyword">mut</span> T&gt;,<br>        T: <span class="hljs-symbol">&#x27;a</span>,<br>        P: <span class="hljs-built_in">FnMut</span>(&amp;T) -&gt; <span class="hljs-built_in">bool</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_partitioned</span></span>&lt;P&gt;(<span class="hljs-keyword">self</span>, predicate: P) -&gt; <span class="hljs-built_in">bool</span><br>    <span class="hljs-keyword">where</span><br>        P: <span class="hljs-built_in">FnMut</span>(Self::Item) -&gt; <span class="hljs-built_in">bool</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">try_fold</span></span>&lt;B, F, R&gt;(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, init: B, f: F) -&gt; R<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(B, Self::Item) -&gt; R,<br>        R: Try&lt;<span class="hljs-literal">Ok</span> = B&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">try_for_each</span></span>&lt;F, R&gt;(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, f: F) -&gt; R<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(Self::Item) -&gt; R,<br>        R: Try&lt;<span class="hljs-literal">Ok</span> = ()&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">fold</span></span>&lt;B, F&gt;(<span class="hljs-keyword">self</span>, init: B, f: F) -&gt; B<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(B, Self::Item) -&gt; B;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">fold_first</span></span>&lt;F&gt;(<span class="hljs-keyword">self</span>, f: F) -&gt; <span class="hljs-built_in">Option</span>&lt;Self::Item&gt;<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(Self::Item, Self::Item) -&gt; Self::Item;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">all</span></span>&lt;F&gt;(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, f: F) -&gt; <span class="hljs-built_in">bool</span><br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(Self::Item) -&gt; <span class="hljs-built_in">bool</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">any</span></span>&lt;F&gt;(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, f: F) -&gt; <span class="hljs-built_in">bool</span><br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(Self::Item) -&gt; <span class="hljs-built_in">bool</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">find</span></span>&lt;P&gt;(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, predicate: P) -&gt; <span class="hljs-built_in">Option</span>&lt;Self::Item&gt;<br>    <span class="hljs-keyword">where</span><br>        P: <span class="hljs-built_in">FnMut</span>(&amp;Self::Item) -&gt; <span class="hljs-built_in">bool</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">find_map</span></span>&lt;B, F&gt;(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, f: F) -&gt; <span class="hljs-built_in">Option</span>&lt;B&gt;<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(Self::Item) -&gt; <span class="hljs-built_in">Option</span>&lt;B&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">try_find</span></span>&lt;F, R&gt;(<br>        &amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, <br>        f: F<br>    ) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-built_in">Option</span>&lt;Self::Item&gt;, &lt;R <span class="hljs-keyword">as</span> Try&gt;::Error&gt;<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(&amp;Self::Item) -&gt; R,<br>        R: Try&lt;<span class="hljs-literal">Ok</span> = <span class="hljs-built_in">bool</span>&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">position</span></span>&lt;P&gt;(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, predicate: P) -&gt; <span class="hljs-built_in">Option</span>&lt;<span class="hljs-built_in">usize</span>&gt;<br>    <span class="hljs-keyword">where</span><br>        P: <span class="hljs-built_in">FnMut</span>(Self::Item) -&gt; <span class="hljs-built_in">bool</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">rposition</span></span>&lt;P&gt;(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, predicate: P) -&gt; <span class="hljs-built_in">Option</span>&lt;<span class="hljs-built_in">usize</span>&gt;<br>    <span class="hljs-keyword">where</span><br>        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">ExactSizeIterator</span> + <span class="hljs-built_in">DoubleEndedIterator</span>,<br>        P: <span class="hljs-built_in">FnMut</span>(Self::Item) -&gt; <span class="hljs-built_in">bool</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">max</span></span>(<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">Option</span>&lt;Self::Item&gt;<br>    <span class="hljs-keyword">where</span><br>        Self::Item: <span class="hljs-built_in">Ord</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">min</span></span>(<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">Option</span>&lt;Self::Item&gt;<br>    <span class="hljs-keyword">where</span><br>        Self::Item: <span class="hljs-built_in">Ord</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">max_by_key</span></span>&lt;B, F&gt;(<span class="hljs-keyword">self</span>, f: F) -&gt; <span class="hljs-built_in">Option</span>&lt;Self::Item&gt;<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(&amp;Self::Item) -&gt; B,<br>        B: <span class="hljs-built_in">Ord</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">max_by</span></span>&lt;F&gt;(<span class="hljs-keyword">self</span>, compare: F) -&gt; <span class="hljs-built_in">Option</span>&lt;Self::Item&gt;<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(&amp;Self::Item, &amp;Self::Item) -&gt; Ordering;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">min_by_key</span></span>&lt;B, F&gt;(<span class="hljs-keyword">self</span>, f: F) -&gt; <span class="hljs-built_in">Option</span>&lt;Self::Item&gt;<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(&amp;Self::Item) -&gt; B,<br>        B: <span class="hljs-built_in">Ord</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">min_by</span></span>&lt;F&gt;(<span class="hljs-keyword">self</span>, compare: F) -&gt; <span class="hljs-built_in">Option</span>&lt;Self::Item&gt;<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(&amp;Self::Item, &amp;Self::Item) -&gt; Ordering;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">rev</span></span>(<span class="hljs-keyword">self</span>) -&gt; Rev&lt;<span class="hljs-keyword">Self</span>&gt;<br>    <span class="hljs-keyword">where</span><br>        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">DoubleEndedIterator</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">unzip</span></span>&lt;A, B, FromA, FromB&gt;(<span class="hljs-keyword">self</span>) -&gt; (FromA, FromB)<br>    <span class="hljs-keyword">where</span><br>        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Iterator</span>&lt;Item = (A, B)&gt;,<br>        FromA: <span class="hljs-built_in">Default</span> + <span class="hljs-built_in">Extend</span>&lt;A&gt;,<br>        FromB: <span class="hljs-built_in">Default</span> + <span class="hljs-built_in">Extend</span>&lt;B&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">copied</span></span>&lt;<span class="hljs-symbol">&#x27;a</span>, T&gt;(<span class="hljs-keyword">self</span>) -&gt; Copied&lt;<span class="hljs-keyword">Self</span>&gt;<br>    <span class="hljs-keyword">where</span><br>        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Iterator</span>&lt;Item = &amp;<span class="hljs-symbol">&#x27;a</span> T&gt;,<br>        T: <span class="hljs-symbol">&#x27;a</span> + <span class="hljs-built_in">Copy</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">cloned</span></span>&lt;<span class="hljs-symbol">&#x27;a</span>, T&gt;(<span class="hljs-keyword">self</span>) -&gt; Cloned&lt;<span class="hljs-keyword">Self</span>&gt;<br>    <span class="hljs-keyword">where</span><br>        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Iterator</span>&lt;Item = &amp;<span class="hljs-symbol">&#x27;a</span> T&gt;,<br>        T: <span class="hljs-symbol">&#x27;a</span> + <span class="hljs-built_in">Clone</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">cycle</span></span>(<span class="hljs-keyword">self</span>) -&gt; Cycle&lt;<span class="hljs-keyword">Self</span>&gt;<br>    <span class="hljs-keyword">where</span><br>        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Clone</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">sum</span></span>&lt;S&gt;(<span class="hljs-keyword">self</span>) -&gt; S<br>    <span class="hljs-keyword">where</span><br>        S: Sum&lt;Self::Item&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">product</span></span>&lt;P&gt;(<span class="hljs-keyword">self</span>) -&gt; P<br>    <span class="hljs-keyword">where</span><br>        P: Product&lt;Self::Item&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">cmp</span></span>&lt;I&gt;(<span class="hljs-keyword">self</span>, other: I) -&gt; Ordering<br>    <span class="hljs-keyword">where</span><br>        I: <span class="hljs-built_in">IntoIterator</span>&lt;Item = Self::Item&gt;,<br>        Self::Item: <span class="hljs-built_in">Ord</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">cmp_by</span></span>&lt;I, F&gt;(<span class="hljs-keyword">self</span>, other: I, cmp: F) -&gt; Ordering<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(Self::Item, &lt;I <span class="hljs-keyword">as</span> <span class="hljs-built_in">IntoIterator</span>&gt;::Item) -&gt; Ordering,<br>        I: <span class="hljs-built_in">IntoIterator</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">partial_cmp</span></span>&lt;I&gt;(<span class="hljs-keyword">self</span>, other: I) -&gt; <span class="hljs-built_in">Option</span>&lt;Ordering&gt;<br>    <span class="hljs-keyword">where</span><br>        I: <span class="hljs-built_in">IntoIterator</span>,<br>        Self::Item: <span class="hljs-built_in">PartialOrd</span>&lt;&lt;I <span class="hljs-keyword">as</span> <span class="hljs-built_in">IntoIterator</span>&gt;::Item&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">partial_cmp_by</span></span>&lt;I, F&gt;(<br>        <span class="hljs-keyword">self</span>, <br>        other: I, <br>        partial_cmp: F<br>    ) -&gt; <span class="hljs-built_in">Option</span>&lt;Ordering&gt;<br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(Self::Item, &lt;I <span class="hljs-keyword">as</span> <span class="hljs-built_in">IntoIterator</span>&gt;::Item) -&gt; <span class="hljs-built_in">Option</span>&lt;Ordering&gt;,<br>        I: <span class="hljs-built_in">IntoIterator</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">eq</span></span>&lt;I&gt;(<span class="hljs-keyword">self</span>, other: I) -&gt; <span class="hljs-built_in">bool</span><br>    <span class="hljs-keyword">where</span><br>        I: <span class="hljs-built_in">IntoIterator</span>,<br>        Self::Item: <span class="hljs-built_in">PartialEq</span>&lt;&lt;I <span class="hljs-keyword">as</span> <span class="hljs-built_in">IntoIterator</span>&gt;::Item&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">eq_by</span></span>&lt;I, F&gt;(<span class="hljs-keyword">self</span>, other: I, eq: F) -&gt; <span class="hljs-built_in">bool</span><br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(Self::Item, &lt;I <span class="hljs-keyword">as</span> <span class="hljs-built_in">IntoIterator</span>&gt;::Item) -&gt; <span class="hljs-built_in">bool</span>,<br>        I: <span class="hljs-built_in">IntoIterator</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">ne</span></span>&lt;I&gt;(<span class="hljs-keyword">self</span>, other: I) -&gt; <span class="hljs-built_in">bool</span><br>    <span class="hljs-keyword">where</span><br>        I: <span class="hljs-built_in">IntoIterator</span>,<br>        Self::Item: <span class="hljs-built_in">PartialEq</span>&lt;&lt;I <span class="hljs-keyword">as</span> <span class="hljs-built_in">IntoIterator</span>&gt;::Item&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">lt</span></span>&lt;I&gt;(<span class="hljs-keyword">self</span>, other: I) -&gt; <span class="hljs-built_in">bool</span><br>    <span class="hljs-keyword">where</span><br>        I: <span class="hljs-built_in">IntoIterator</span>,<br>        Self::Item: <span class="hljs-built_in">PartialOrd</span>&lt;&lt;I <span class="hljs-keyword">as</span> <span class="hljs-built_in">IntoIterator</span>&gt;::Item&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">le</span></span>&lt;I&gt;(<span class="hljs-keyword">self</span>, other: I) -&gt; <span class="hljs-built_in">bool</span><br>    <span class="hljs-keyword">where</span><br>        I: <span class="hljs-built_in">IntoIterator</span>,<br>        Self::Item: <span class="hljs-built_in">PartialOrd</span>&lt;&lt;I <span class="hljs-keyword">as</span> <span class="hljs-built_in">IntoIterator</span>&gt;::Item&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">gt</span></span>&lt;I&gt;(<span class="hljs-keyword">self</span>, other: I) -&gt; <span class="hljs-built_in">bool</span><br>    <span class="hljs-keyword">where</span><br>        I: <span class="hljs-built_in">IntoIterator</span>,<br>        Self::Item: <span class="hljs-built_in">PartialOrd</span>&lt;&lt;I <span class="hljs-keyword">as</span> <span class="hljs-built_in">IntoIterator</span>&gt;::Item&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">ge</span></span>&lt;I&gt;(<span class="hljs-keyword">self</span>, other: I) -&gt; <span class="hljs-built_in">bool</span><br>    <span class="hljs-keyword">where</span><br>        I: <span class="hljs-built_in">IntoIterator</span>,<br>        Self::Item: <span class="hljs-built_in">PartialOrd</span>&lt;&lt;I <span class="hljs-keyword">as</span> <span class="hljs-built_in">IntoIterator</span>&gt;::Item&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_sorted</span></span>(<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">bool</span><br>    <span class="hljs-keyword">where</span><br>        Self::Item: <span class="hljs-built_in">PartialOrd</span>&lt;Self::Item&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_sorted_by</span></span>&lt;F&gt;(<span class="hljs-keyword">self</span>, compare: F) -&gt; <span class="hljs-built_in">bool</span><br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(&amp;Self::Item, &amp;Self::Item) -&gt; <span class="hljs-built_in">Option</span>&lt;Ordering&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_sorted_by_key</span></span>&lt;F, K&gt;(<span class="hljs-keyword">self</span>, f: F) -&gt; <span class="hljs-built_in">bool</span><br>    <span class="hljs-keyword">where</span><br>        F: <span class="hljs-built_in">FnMut</span>(Self::Item) -&gt; K,<br>        K: <span class="hljs-built_in">PartialOrd</span>&lt;K&gt;;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>实现</p>
<ol>
<li><p>Iterator&lt;Item &#x3D; T&gt;类型可以被迭代并产生T类型。没有IteratorMut trait。每个Iterator实现可以指定它返回的是不可变引用、可变引用还是拥有通过Item关联类型的值。</p>
<table>
<thead>
<tr>
<th>Vec<T> method</th>
<th>Returns</th>
</tr>
</thead>
<tbody><tr>
<td>.iter()</td>
<td>Iterator&lt;Item &#x3D; &amp;T&gt;</td>
</tr>
<tr>
<td>.iter_mut()</td>
<td>Iterator&lt;Item &#x3D; &amp;mut T&gt;</td>
</tr>
<tr>
<td>.into_iter()</td>
<td>Iterator&lt;Item &#x3D; T&gt;</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p>大多数类型没有它们自己的迭代器。如果一个类型是可迭代的，我们几乎总是实现自定义的迭代器类型来迭代它，而不是让它自己迭代。</p>
<p> 可以使用Vec 的iter方法对自己的类型迭代</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MyType</span></span> &#123;<br>    items: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">String</span>&gt;<br>&#125;<br><br><span class="hljs-keyword">impl</span> MyType &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">iter</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-keyword">impl</span> <span class="hljs-built_in">Iterator</span>&lt;Item = &amp;<span class="hljs-built_in">String</span>&gt; &#123;<br>        <span class="hljs-keyword">self</span>.items.iter()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>It says that any mutable reference to an iterator is also an iterator. This is useful to know because it allows us to use iterator methods with self receivers as if they had &amp;mut self receivers.</p>
<ol>
<li>这里是说Iterator定义的方法，接受self的方法和接受&amp;mut self的方法是一样的</li>
</ol>
</li>
<li><p>如果我们想对一个超过三项的迭代器进行处理的函数，函数要先消耗三个元素，再进行处理</p>
<ol>
<li><p>这是一个错误范例</p>
<p> take方法接受self对象，换句话说，它消耗了iter这个实例，接下来再调用iter会报错</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">example</span></span>&lt;I: <span class="hljs-built_in">Iterator</span>&lt;Item = <span class="hljs-built_in">i32</span>&gt;&gt;(<span class="hljs-keyword">mut</span> iter: I) &#123;<br>    <span class="hljs-keyword">let</span> first3: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">i32</span>&gt; = iter.take(<span class="hljs-number">3</span>).collect();<br>    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> iter &#123; <span class="hljs-comment">// ❌ iter consumed in line above</span><br>        <span class="hljs-comment">// process remaining items</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>下面两种方法可以达到目的</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">example</span></span>&lt;I: <span class="hljs-built_in">Iterator</span>&lt;Item = <span class="hljs-built_in">i32</span>&gt;&gt;(<span class="hljs-keyword">mut</span> iter: I) &#123;<br>    <span class="hljs-keyword">let</span> first3: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">i32</span>&gt; = <span class="hljs-built_in">vec!</span>[<br>        iter.next().unwrap(),<br>        iter.next().unwrap(),<br>        iter.next().unwrap(),<br>    ];<br>    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> iter &#123; <span class="hljs-comment">// ✅</span><br>        <span class="hljs-comment">// process remaining items</span><br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">example</span></span>&lt;I: <span class="hljs-built_in">Iterator</span>&lt;Item = <span class="hljs-built_in">i32</span>&gt;&gt;(<span class="hljs-keyword">mut</span> iter: I) &#123;<br>    <span class="hljs-keyword">let</span> first3: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">i32</span>&gt; = iter.by_ref().take(<span class="hljs-number">3</span>).collect();<br>    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> iter &#123; <span class="hljs-comment">// ✅</span><br>        <span class="hljs-comment">// process remaining items</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="2-IntoIter"><a href="#2-IntoIter" class="headerlink" title="2. IntoIter"></a>2. IntoIter</h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">IntoIterator</span></span> <br><span class="hljs-keyword">where</span><br>    &lt;Self::IntoIter <span class="hljs-keyword">as</span> <span class="hljs-built_in">Iterator</span>&gt;::Item == Self::Item, <br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Item</span></span>;<br>    <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">IntoIter</span></span>: <span class="hljs-built_in">Iterator</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">into_iter</span></span>(<span class="hljs-keyword">self</span>) -&gt; Self::IntoIter;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>作用</p>
<p> 让类型T转换为迭代器类型，对于不可变引用、可变引用也如此</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// vec = Vec&lt;T&gt;</span><br><span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> vec &#123;&#125; <span class="hljs-comment">// v = T</span><br><br><span class="hljs-comment">// above line desugared</span><br><span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> vec.into_iter() &#123;&#125;<br><br><span class="hljs-comment">// vec = Vec&lt;T&gt;</span><br><span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> &amp;vec &#123;&#125; <span class="hljs-comment">// v = &amp;T</span><br><br><span class="hljs-comment">// above example desugared</span><br><span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> (&amp;vec).into_iter() &#123;&#125;<br><br><span class="hljs-comment">// vec = Vec&lt;T&gt;</span><br><span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> &amp;<span class="hljs-keyword">mut</span> vec &#123;&#125; <span class="hljs-comment">// v = &amp;mut T</span><br><br><span class="hljs-comment">// above example desugared</span><br><span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> (&amp;<span class="hljs-keyword">mut</span> vec).into_iter() &#123;&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="3-FromIterator"><a href="#3-FromIterator" class="headerlink" title="3. FromIterator"></a>3. FromIterator</h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">FromIterator</span></span>&lt;A&gt; &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">from_iter</span></span>&lt;T&gt;(iter: T) -&gt; <span class="hljs-keyword">Self</span><br>    <span class="hljs-keyword">where</span><br>        T: <span class="hljs-built_in">IntoIterator</span>&lt;Item = A&gt;;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>作用</p>
<p> 从迭代器类型转换为类型T</p>
<p> 比如collect方法</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">collect</span></span>&lt;B&gt;(<span class="hljs-keyword">self</span>) -&gt; B<br><span class="hljs-keyword">where</span><br>    B: FromIterator&lt;Self::Item&gt;;<br></code></pre></td></tr></table></figure>
</li>
<li><p>例子</p>
<p> collect 方法“收集”一个Iterator&lt;Item &#x3D; char&gt; 到 String:</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">filter_letters</span></span>(string: &amp;<span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">String</span> &#123;<br>    string.chars().filter(|c| c.is_alphabetic()).collect()<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="4-标准库类型靠迭代器相互转换的例子"><a href="#4-标准库类型靠迭代器相互转换的例子" class="headerlink" title="4. 标准库类型靠迭代器相互转换的例子"></a>4. 标准库类型靠迭代器相互转换的例子</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::collections::&#123;BTreeSet, HashMap, HashSet, LinkedList&#125;;<br><br><span class="hljs-comment">// String -&gt; HashSet&lt;char&gt;</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">unique_chars</span></span>(string: &amp;<span class="hljs-built_in">str</span>) -&gt; HashSet&lt;<span class="hljs-built_in">char</span>&gt; &#123;<br>    string.chars().collect()<br>&#125;<br><br><span class="hljs-comment">// Vec&lt;T&gt; -&gt; BTreeSet&lt;T&gt;</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">ordered_unique_items</span></span>&lt;T: <span class="hljs-built_in">Ord</span>&gt;(vec: <span class="hljs-built_in">Vec</span>&lt;T&gt;) -&gt; BTreeSet&lt;T&gt; &#123;<br>    vec.into_iter().collect()<br>&#125;<br><br><span class="hljs-comment">// HashMap&lt;K, V&gt; -&gt; LinkedList&lt;(K, V)&gt;</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">entry_list</span></span>&lt;K, V&gt;(map: HashMap&lt;K, V&gt;) -&gt; LinkedList&lt;(K, V)&gt; &#123;<br>    map.into_iter().collect()<br>&#125;<br><br><span class="hljs-comment">// and countless more possible examples</span><br></code></pre></td></tr></table></figure>

<h2 id="九、IO-Trait"><a href="#九、IO-Trait" class="headerlink" title="九、IO Trait"></a>九、IO Trait</h2><h3 id="1-Read-x2F-Write"><a href="#1-Read-x2F-Write" class="headerlink" title="1. Read&#x2F;Write"></a>1. Read&#x2F;Write</h3><ol>
<li><p>定义</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Read</span></span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">read</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, buf: &amp;<span class="hljs-keyword">mut</span> [<span class="hljs-built_in">u8</span>]) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-built_in">usize</span>&gt;;<br><br>    <span class="hljs-comment">// provided default impls</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">read_vectored</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, bufs: &amp;<span class="hljs-keyword">mut</span> [IoSliceMut&lt;<span class="hljs-symbol">&#x27;_</span>&gt;]) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-built_in">usize</span>&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_read_vectored</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">bool</span>;<br>    <span class="hljs-keyword">unsafe</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">initializer</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; Initializer;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">read_to_end</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, buf: &amp;<span class="hljs-keyword">mut</span> <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">u8</span>&gt;) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-built_in">usize</span>&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">read_to_string</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, buf: &amp;<span class="hljs-keyword">mut</span> <span class="hljs-built_in">String</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-built_in">usize</span>&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">read_exact</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, buf: &amp;<span class="hljs-keyword">mut</span> [<span class="hljs-built_in">u8</span>]) -&gt; <span class="hljs-built_in">Result</span>&lt;()&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">by_ref</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">Self</span><br>    <span class="hljs-keyword">where</span><br>        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Sized</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">bytes</span></span>(<span class="hljs-keyword">self</span>) -&gt; Bytes&lt;<span class="hljs-keyword">Self</span>&gt;<br>    <span class="hljs-keyword">where</span><br>        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Sized</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">chain</span></span>&lt;R: Read&gt;(<span class="hljs-keyword">self</span>, next: R) -&gt; Chain&lt;<span class="hljs-keyword">Self</span>, R&gt;<br>    <span class="hljs-keyword">where</span><br>        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Sized</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">take</span></span>(<span class="hljs-keyword">self</span>, limit: <span class="hljs-built_in">u64</span>) -&gt; Take&lt;<span class="hljs-keyword">Self</span>&gt;<br>    <span class="hljs-keyword">where</span><br>        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Sized</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Write</span></span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">write</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, buf: &amp;[<span class="hljs-built_in">u8</span>]) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-built_in">usize</span>&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">flush</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">Result</span>&lt;()&gt;;<br><br>    <span class="hljs-comment">// provided default impls</span><br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">write_vectored</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, bufs: &amp;[IoSlice&lt;<span class="hljs-symbol">&#x27;_</span>&gt;]) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-built_in">usize</span>&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">is_write_vectored</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-built_in">bool</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">write_all</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, buf: &amp;[<span class="hljs-built_in">u8</span>]) -&gt; <span class="hljs-built_in">Result</span>&lt;()&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">write_all_vectored</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, bufs: &amp;<span class="hljs-keyword">mut</span> [IoSlice&lt;<span class="hljs-symbol">&#x27;_</span>&gt;]) -&gt; <span class="hljs-built_in">Result</span>&lt;()&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">write_fmt</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, fmt: Arguments&lt;<span class="hljs-symbol">&#x27;_</span>&gt;) -&gt; <span class="hljs-built_in">Result</span>&lt;()&gt;;<br>    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">by_ref</span></span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) -&gt; &amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">Self</span><br>    <span class="hljs-keyword">where</span><br>        <span class="hljs-keyword">Self</span>: <span class="hljs-built_in">Sized</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>实现</p>
<ol>
<li><p>标准库同样提供了泛型覆盖实现</p>
<p> Read类型的任何可变引用也都是Read，Write同理</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">impl</span>&lt;R: Read + ?<span class="hljs-built_in">Sized</span>&gt; Read <span class="hljs-keyword">for</span> &amp;<span class="hljs-keyword">mut</span> R;<br><span class="hljs-keyword">impl</span>&lt;W: Write + ?<span class="hljs-built_in">Sized</span>&gt; Write <span class="hljs-keyword">for</span> &amp;<span class="hljs-keyword">mut</span> W;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>例子</p>
<p> &amp;[u8] 实现了Read，Vec<u8>实现了Write</p>
<p> 因此我们可以对我们的文件处理函数进行简单的单元测试，通过使用String转换为&amp;[u8]以及从Vec<u8> 转换为String：</p>
 <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::path::Path;<br><span class="hljs-keyword">use</span> std::fs::File;<br><span class="hljs-keyword">use</span> std::io::Read;<br><span class="hljs-keyword">use</span> std::io::Write;<br><span class="hljs-keyword">use</span> std::io;<br><br><span class="hljs-comment">// function we want to test</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">uppercase</span></span>&lt;R: Read, W: Write&gt;(<span class="hljs-keyword">mut</span> read: R, <span class="hljs-keyword">mut</span> write: W) -&gt; <span class="hljs-built_in">Result</span>&lt;(), io::Error&gt; &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> buffer = <span class="hljs-built_in">String</span>::new();<br>    read.read_to_string(&amp;<span class="hljs-keyword">mut</span> buffer)?;<br>    <span class="hljs-keyword">let</span> uppercase = buffer.to_uppercase();<br>    write.write_all(uppercase.as_bytes())?;<br>    write.flush()?;<br>    <span class="hljs-literal">Ok</span>(())<br>&#125;<br><br><span class="hljs-comment">// in actual program we&#x27;d pass Files</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">example</span></span>(in_path: &amp;Path, out_path: &amp;Path) -&gt; <span class="hljs-built_in">Result</span>&lt;(), io::Error&gt; &#123;<br>    <span class="hljs-keyword">let</span> in_file = File::open(in_path)?;<br>    <span class="hljs-keyword">let</span> out_file = File::open(out_path)?;<br>    uppercase(in_file, out_file)<br>&#125;<br><br><span class="hljs-comment">// however in unit tests we can use Strings!</span><br><span class="hljs-meta">#[test]</span> <span class="hljs-comment">// ✅</span><br><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">example_test</span></span>() &#123;<br>    <span class="hljs-keyword">let</span> in_file: <span class="hljs-built_in">String</span> = <span class="hljs-string">&quot;i am screaming&quot;</span>.into();<br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> out_file: <span class="hljs-built_in">Vec</span>&lt;<span class="hljs-built_in">u8</span>&gt; = <span class="hljs-built_in">Vec</span>::new();<br>    uppercase(in_file.as_bytes(), &amp;<span class="hljs-keyword">mut</span> out_file).unwrap();<br>    <span class="hljs-keyword">let</span> out_result = <span class="hljs-built_in">String</span>::from_utf8(out_file).unwrap();<br>    <span class="hljs-built_in">assert_eq!</span>(out_result, <span class="hljs-string">&quot;I AM SCREAMING&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Rust/">#Rust</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Rust标准库涉及的Trait</div>
      <div>https://gwzlchn.github.io/202205/rust-traits/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Zelin Wang</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年5月18日</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2022年5月18日</div>
        </div>
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/202205/cs144-lab4/" title="CS144-Lab4实验笔记">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">CS144-Lab4实验笔记</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/202205/cs144-lab3/" title="CS144-Lab3实验笔记">
                        <span class="hidden-mobile">CS144-Lab3实验笔记</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="gitalk-container"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#gitalk-container', function() {
      Fluid.utils.createCssLink('/css/gitalk.css')
      Fluid.utils.createScript('https://lib.baomitu.com/gitalk/1.7.2/gitalk.min.js', function() {
        var options = Object.assign(
          {"clientID":"92499b3e9ca46e054919","clientSecret":"eef0bc1146a28cdb3d17fd4cf149158cab4ffa2f","repo":"gwzlchn.github.io","owner":"Gwzlchn","admin":["Gwzlchn"],"language":"zh-CN","labels":["Gitalk"],"perPage":10,"pagerDirection":"last","distractionFreeMode":false,"createIssueManually":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token"},
          {
            id: '1619a97e0c5fdc482d6f9d98b44cbeb6'
          }
        )
        var gitalk = new Gitalk(options);
        gitalk.render('gitalk-container');
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
      <div class="col-lg-7 mx-auto nopadding-x-md">
        <div class="container custom mx-auto">
          <script type="text/javascript" src="//rf.revolvermaps.com/0/0/6.js?i=5lzo9y8g750&amp;m=7&amp;c=baff00&amp;cr1=ff007e&amp;f=arial&amp;l=0&amp;bv=40" async="async"></script>
        </div>
      </div>
    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Powered by Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>With Fluid Theme</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  

  

  

  

  

  

  
    
  




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="/js/leancloud.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
